import _extends from"@babel/runtime/helpers/esm/extends";import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import*as React from"react";import{isFragment}from"react-is";import PropTypes from"prop-types";import*as ReactDOM from"react-dom";import ownerDocument from"../utils/ownerDocument";import List from"../List";import getScrollbarSize from"../utils/getScrollbarSize";import useForkRef from"../utils/useForkRef";function nextItem(e,t,r){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:r?null:e.firstChild}function previousItem(e,t,r){return e===t?r?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:r?null:e.lastChild}function textCriteriaMatches(e,t){if(void 0===t)return!0;var r=e.innerText;return 0!==(r=(r=void 0===r?e.textContent:r).trim().toLowerCase()).length&&(t.repeating?r[0]===t.keys[0]:0===r.indexOf(t.keys.join("")))}function moveFocus(e,t,r,o,n,i){for(var s=!1,a=n(e,t,!!t&&r);a;){if(a===e.firstChild){if(s)return;s=!0}var u=!o&&(a.disabled||"true"===a.getAttribute("aria-disabled"));if(a.hasAttribute("tabindex")&&textCriteriaMatches(a,i)&&!u)return void a.focus();a=n(e,a,r)}}var useEnhancedEffect="undefined"==typeof window?React.useEffect:React.useLayoutEffect,MenuList=React.forwardRef(function(e,t){var r=e.actions,o=e.autoFocus,n=void 0!==o&&o,i=e.autoFocusItem,s=void 0!==i&&i,a=e.children,o=e.className,i=e.disabledItemsFocusable,u=void 0!==i&&i,i=e.disableListWrap,c=void 0!==i&&i,l=e.onKeyDown,i=e.variant,p=void 0===i?"selectedMenu":i,e=_objectWithoutProperties(e,["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"]),d=React.useRef(null),m=React.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});useEnhancedEffect(function(){n&&d.current.focus()},[n]),React.useImperativeHandle(r,function(){return{adjustStyleForScrollbar:function(e,t){var r=!d.current.style.width;return e.clientHeight<d.current.clientHeight&&r&&(r="".concat(getScrollbarSize(!0),"px"),d.current.style["rtl"===t.direction?"paddingLeft":"paddingRight"]=r,d.current.style.width="calc(100% + ".concat(r,")")),d.current}}},[]);var r=React.useCallback(function(e){d.current=ReactDOM.findDOMNode(e)},[]),t=useForkRef(r,t),f=-1;React.Children.forEach(a,function(e,t){React.isValidElement(e)&&("production"!==process.env.NODE_ENV&&isFragment(e)&&console.error(["Material-UI: The Menu component doesn't accept a Fragment as a child.","Consider providing an array instead."].join("\n")),e.props.disabled||("selectedMenu"===p&&e.props.selected||-1===f)&&(f=t))});a=React.Children.map(a,function(e,t){if(t!==f)return e;t={};return s&&(t.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===p&&(t.tabIndex=0),React.cloneElement(e,t)});return React.createElement(List,_extends({role:"menu",ref:t,className:o,onKeyDown:function(e){var t,r,o=d.current,n=e.key,i=ownerDocument(o).activeElement;"ArrowDown"===n?(e.preventDefault(),moveFocus(o,i,c,u,nextItem)):"ArrowUp"===n?(e.preventDefault(),moveFocus(o,i,c,u,previousItem)):"Home"===n?(e.preventDefault(),moveFocus(o,null,c,u,nextItem)):"End"===n?(e.preventDefault(),moveFocus(o,null,c,u,previousItem)):1===n.length&&(t=m.current,r=n.toLowerCase(),n=performance.now(),0<t.keys.length&&(500<n-t.lastTime?(t.keys=[],t.repeating=!0,t.previousKeyMatched=!0):t.repeating&&r!==t.keys[0]&&(t.repeating=!1)),t.lastTime=n,t.keys.push(r),r=i&&!t.repeating&&textCriteriaMatches(i,t),t.previousKeyMatched&&(r||moveFocus(o,i,!1,u,nextItem,t))?e.preventDefault():t.previousKeyMatched=!1),l&&l(e)},tabIndex:n?0:-1},e),a)});"production"!==process.env.NODE_ENV&&(MenuList.propTypes={autoFocus:PropTypes.bool,autoFocusItem:PropTypes.bool,children:PropTypes.node,className:PropTypes.string,disabledItemsFocusable:PropTypes.bool,disableListWrap:PropTypes.bool,onKeyDown:PropTypes.func,variant:PropTypes.oneOf(["menu","selectedMenu"])});export default MenuList;