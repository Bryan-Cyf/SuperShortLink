import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import*as ReactDOM from"react-dom";import PropTypes from"prop-types";import{getThemeProps,useTheme}from"@material-ui/styles";import{elementAcceptingRef,HTMLElementType}from"@material-ui/utils";import deprecatedPropType from"../utils/deprecatedPropType";import ownerDocument from"../utils/ownerDocument";import Portal from"../Portal";import createChainedFunction from"../utils/createChainedFunction";import useForkRef from"../utils/useForkRef";import useEventCallback from"../utils/useEventCallback";import zIndex from"../styles/zIndex";import ModalManager,{ariaHidden}from"./ModalManager";import TrapFocus from"../Unstable_TrapFocus";import SimpleBackdrop from"./SimpleBackdrop";function getContainer(e){return e="function"==typeof e?e():e,ReactDOM.findDOMNode(e)}function getHasTransition(e){return!!e.children&&e.children.props.hasOwnProperty("in")}var defaultManager=new ModalManager,styles=function(e){return{root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}},Modal=React.forwardRef(function(e,o){function r(){return ownerDocument(D.current)}function t(){return B.current.modalRef=A.current,B.current.mountNode=D.current,B.current}function n(){E.mount(t(),{disableScrollLock:C}),A.current.scrollTop=0}var a=useTheme(),p=getThemeProps({name:"MuiModal",props:_extends({},e),theme:a}),s=p.BackdropComponent,c=void 0===s?SimpleBackdrop:s,i=p.BackdropProps,l=p.children,d=p.closeAfterTransition,u=void 0!==d&&d,m=p.container,f=p.disableAutoFocus,b=void 0!==f&&f,y=p.disableBackdropClick,T=void 0!==y&&y,k=p.disableEnforceFocus,P=void 0!==k&&k,h=p.disableEscapeKeyDown,R=void 0!==h&&h,e=p.disablePortal,s=void 0!==e&&e,d=p.disableRestoreFocus,f=void 0!==d&&d,y=p.disableScrollLock,C=void 0!==y&&y,k=p.hideBackdrop,h=void 0!==k&&k,e=p.keepMounted,d=void 0!==e&&e,y=p.manager,E=void 0===y?defaultManager:y,v=p.onBackdropClick,g=p.onClose,F=p.onEscapeKeyDown,M=p.onRendered,x=p.open,k=_objectWithoutProperties(p,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","onRendered","open"]),e=React.useState(!0),y=e[0],w=e[1],B=React.useRef({}),D=React.useRef(null),A=React.useRef(null),o=useForkRef(A,o),I=getHasTransition(p),K=useEventCallback(function(){var e=getContainer(m)||r().body;E.add(t(),e),A.current&&n()}),_=React.useCallback(function(){return E.isTopModal(t())},[E]),p=useEventCallback(function(e){(D.current=e)&&(M&&M(),x&&_()?n():ariaHidden(A.current,!0))}),S=React.useCallback(function(){E.remove(t())},[E]);if(React.useEffect(function(){return function(){S()}},[S]),React.useEffect(function(){x?K():I&&u||S()},[x,S,I,u,K]),!d&&!x&&(!I||y))return null;d=styles(a||{zIndex:zIndex}),a={};return void 0===l.props.tabIndex&&(a.tabIndex=l.props.tabIndex||"-1"),I&&(a.onEnter=createChainedFunction(function(){w(!1)},l.props.onEnter),a.onExited=createChainedFunction(function(){w(!0),u&&S()},l.props.onExited)),React.createElement(Portal,{ref:p,container:m,disablePortal:s},React.createElement("div",_extends({ref:o,onKeyDown:function(e){"Escape"===e.key&&_()&&(F&&F(e),R||(e.stopPropagation(),g&&g(e,"escapeKeyDown")))},role:"presentation"},k,{style:_extends({},d.root,!x&&y?d.hidden:{},k.style)}),h?null:React.createElement(c,_extends({open:x,onClick:function(e){e.target===e.currentTarget&&(v&&v(e),!T&&g&&g(e,"backdropClick"))}},i)),React.createElement(TrapFocus,{disableEnforceFocus:P,disableAutoFocus:b,disableRestoreFocus:f,getDoc:r,isEnabled:_,open:x},React.cloneElement(l,a))))});"production"!==process.env.NODE_ENV&&(Modal.propTypes={BackdropComponent:PropTypes.elementType,BackdropProps:PropTypes.object,children:elementAcceptingRef.isRequired,closeAfterTransition:PropTypes.bool,container:PropTypes.oneOfType([HTMLElementType,PropTypes.instanceOf(React.Component),PropTypes.func]),disableAutoFocus:PropTypes.bool,disableBackdropClick:deprecatedPropType(PropTypes.bool,"Use the onClose prop with the `reason` argument to filter the `backdropClick` events."),disableEnforceFocus:PropTypes.bool,disableEscapeKeyDown:PropTypes.bool,disablePortal:PropTypes.bool,disableRestoreFocus:PropTypes.bool,disableScrollLock:PropTypes.bool,hideBackdrop:PropTypes.bool,keepMounted:PropTypes.bool,manager:PropTypes.object,onBackdropClick:deprecatedPropType(PropTypes.func,"Use the onClose prop with the `reason` argument to handle the `backdropClick` events."),onClose:PropTypes.func,onEscapeKeyDown:deprecatedPropType(PropTypes.func,"Use the onClose prop with the `reason` argument to handle the `escapeKeyDown` events."),onRendered:deprecatedPropType(PropTypes.func,"Use the ref instead."),open:PropTypes.bool.isRequired});export default Modal;export{styles};