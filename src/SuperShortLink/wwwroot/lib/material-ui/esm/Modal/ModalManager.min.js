import _classCallCheck from"@babel/runtime/helpers/esm/classCallCheck";import _createClass from"@babel/runtime/helpers/esm/createClass";import _toConsumableArray from"@babel/runtime/helpers/esm/toConsumableArray";import getScrollbarSize from"../utils/getScrollbarSize";import ownerDocument from"../utils/ownerDocument";import ownerWindow from"../utils/ownerWindow";function isOverflowing(e){var n=ownerDocument(e);return n.body===e?ownerWindow(n).innerWidth>n.documentElement.clientWidth:e.scrollHeight>e.clientHeight}function ariaHidden(e,n){n?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function getPaddingRight(e){return parseInt(window.getComputedStyle(e)["padding-right"],10)||0}function ariaHiddenSiblings(e,n,t){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],r=4<arguments.length?arguments[4]:void 0,o=[n,t].concat(_toConsumableArray(i)),a=["TEMPLATE","SCRIPT","STYLE"];[].forEach.call(e.children,function(e){1===e.nodeType&&-1===o.indexOf(e)&&-1===a.indexOf(e.tagName)&&ariaHidden(e,r)})}function findIndexOf(e,t){var i=-1;return e.some(function(e,n){return!!t(e)&&(i=n,!0)}),i}function handleContainer(e,n){var t,i,r=[],o=[],e=e.container;n.disableScrollLock||(isOverflowing(e)&&(i=getScrollbarSize(),r.push({value:e.style.paddingRight,key:"padding-right",el:e}),e.style["padding-right"]="".concat(getPaddingRight(e)+i,"px"),t=ownerDocument(e).querySelectorAll(".mui-fixed"),[].forEach.call(t,function(e){o.push(e.style.paddingRight),e.style.paddingRight="".concat(getPaddingRight(e)+i,"px")})),e="HTML"===(n=e.parentElement).nodeName&&"scroll"===window.getComputedStyle(n)["overflow-y"]?n:e,r.push({value:e.style.overflow,key:"overflow",el:e}),e.style.overflow="hidden");return function(){t&&[].forEach.call(t,function(e,n){o[n]?e.style.paddingRight=o[n]:e.style.removeProperty("padding-right")}),r.forEach(function(e){var n=e.value,t=e.el,e=e.key;n?t.style.setProperty(e,n):t.style.removeProperty(e)})}}function getHiddenSiblings(e){var n=[];return[].forEach.call(e.children,function(e){e.getAttribute&&"true"===e.getAttribute("aria-hidden")&&n.push(e)}),n}var ModalManager=function(){function e(){_classCallCheck(this,e),this.modals=[],this.containers=[]}return _createClass(e,[{key:"add",value:function(e,n){var t=this.modals.indexOf(e);if(-1!==t)return t;t=this.modals.length,this.modals.push(e),e.modalRef&&ariaHidden(e.modalRef,!1);var i=getHiddenSiblings(n);ariaHiddenSiblings(n,e.mountNode,e.modalRef,i,!0);var r=findIndexOf(this.containers,function(e){return e.container===n});return-1!==r?this.containers[r].modals.push(e):this.containers.push({modals:[e],container:n,restore:null,hiddenSiblingNodes:i}),t}},{key:"mount",value:function(n,e){var t=findIndexOf(this.containers,function(e){return-1!==e.modals.indexOf(n)}),t=this.containers[t];t.restore||(t.restore=handleContainer(t,e))}},{key:"remove",value:function(n){var e=this.modals.indexOf(n);if(-1===e)return e;var t=findIndexOf(this.containers,function(e){return-1!==e.modals.indexOf(n)}),i=this.containers[t];return i.modals.splice(i.modals.indexOf(n),1),this.modals.splice(e,1),0===i.modals.length?(i.restore&&i.restore(),n.modalRef&&ariaHidden(n.modalRef,!0),ariaHiddenSiblings(i.container,n.mountNode,n.modalRef,i.hiddenSiblingNodes,!1),this.containers.splice(t,1)):(i=i.modals[i.modals.length-1]).modalRef&&ariaHidden(i.modalRef,!1),e}},{key:"isTopModal",value:function(e){return 0<this.modals.length&&this.modals[this.modals.length-1]===e}}]),e}();export{ariaHidden,ModalManager as default};