import _extends from"@babel/runtime/helpers/esm/extends";import _toConsumableArray from"@babel/runtime/helpers/esm/toConsumableArray";import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import*as React from"react";import PropTypes from"prop-types";import{TransitionGroup}from"react-transition-group";import clsx from"clsx";import withStyles from"../styles/withStyles";import Ripple from"./Ripple";var DURATION=550,DELAY_RIPPLE=80,styles=function(e){return{root:{overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"},ripple:{opacity:0,position:"absolute"},rippleVisible:{opacity:.3,transform:"scale(1)",animation:"$enter ".concat(DURATION,"ms ").concat(e.transitions.easing.easeInOut)},ripplePulsate:{animationDuration:"".concat(e.transitions.duration.shorter,"ms")},child:{opacity:1,display:"block",width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"currentColor"},childLeaving:{opacity:0,animation:"$exit ".concat(DURATION,"ms ").concat(e.transitions.easing.easeInOut)},childPulsate:{position:"absolute",left:0,top:0,animation:"$pulsate 2500ms ".concat(e.transitions.easing.easeInOut," 200ms infinite")},"@keyframes enter":{"0%":{transform:"scale(0)",opacity:.1},"100%":{transform:"scale(1)",opacity:.3}},"@keyframes exit":{"0%":{opacity:1},"100%":{opacity:0}},"@keyframes pulsate":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(0.92)"},"100%":{transform:"scale(1)"}}}},TouchRipple=React.forwardRef(function(e,t){var r=e.center,p=void 0!==r&&r,i=e.classes,n=e.className,o=_objectWithoutProperties(e,["center","classes","className"]),r=React.useState([]),e=r[0],a=r[1],s=React.useRef(0),c=React.useRef(null);React.useEffect(function(){c.current&&(c.current(),c.current=null)},[e]);var m=React.useRef(!1),h=React.useRef(null),f=React.useRef(null),R=React.useRef(null);React.useEffect(function(){return function(){clearTimeout(h.current)}},[]);var d=React.useCallback(function(e){var t=e.pulsate,r=e.rippleX,n=e.rippleY,o=e.rippleSize,e=e.cb;a(function(e){return[].concat(_toConsumableArray(e),[React.createElement(Ripple,{key:s.current,classes:i,timeout:DURATION,pulsate:t,rippleX:r,rippleY:n,rippleSize:o})])}),s.current+=1,c.current=e},[i]),l=React.useCallback(function(){var e,t,r,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=2<arguments.length?arguments[2]:void 0,a=o.pulsate,s=void 0!==a&&a,c=o.center,l=void 0===c?p||o.pulsate:c,u=o.fakeElement,a=void 0!==u&&u;"mousedown"===n.type&&m.current?m.current=!1:("touchstart"===n.type&&(m.current=!0),o=(c=a?null:R.current)?c.getBoundingClientRect():{width:0,height:0,left:0,top:0},t=l||0===n.clientX&&0===n.clientY||!n.clientX&&!n.touches?(e=Math.round(o.width/2),Math.round(o.height/2)):(a=(u=n.touches?n.touches[0]:n).clientX,u=u.clientY,e=Math.round(a-o.left),Math.round(u-o.top)),l?(r=Math.sqrt((2*Math.pow(o.width,2)+Math.pow(o.height,2))/3))%2==0&&(r+=1):(o=2*Math.max(Math.abs((c?c.clientWidth:0)-e),e)+2,c=2*Math.max(Math.abs((c?c.clientHeight:0)-t),t)+2,r=Math.sqrt(Math.pow(o,2)+Math.pow(c,2))),n.touches?null===f.current&&(f.current=function(){d({pulsate:s,rippleX:e,rippleY:t,rippleSize:r,cb:i})},h.current=setTimeout(function(){f.current&&(f.current(),f.current=null)},DELAY_RIPPLE)):d({pulsate:s,rippleX:e,rippleY:t,rippleSize:r,cb:i}))},[p,d]),u=React.useCallback(function(){l({},{pulsate:!0})},[l]),b=React.useCallback(function(e,t){return clearTimeout(h.current),"touchend"===e.type&&f.current?(e.persist(),f.current(),f.current=null,void(h.current=setTimeout(function(){b(e,t)}))):(f.current=null,a(function(e){return 0<e.length?e.slice(1):e}),void(c.current=t))},[]);return React.useImperativeHandle(t,function(){return{pulsate:u,start:l,stop:b}},[u,l,b]),React.createElement("span",_extends({className:clsx(i.root,n),ref:R},o),React.createElement(TransitionGroup,{component:null,exit:!0},e))});"production"!==process.env.NODE_ENV&&(TouchRipple.propTypes={center:PropTypes.bool,classes:PropTypes.object.isRequired,className:PropTypes.string});export default withStyles(styles,{flip:!1,name:"MuiTouchRipple"})(React.memo(TouchRipple));export{DELAY_RIPPLE,styles};