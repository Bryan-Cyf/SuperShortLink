import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import PropTypes from"prop-types";import*as ReactDOM from"react-dom";import{elementTypeAcceptingRef}from"@material-ui/utils";import{getThemeProps}from"@material-ui/styles";import Drawer,{getAnchor,isHorizontal}from"../Drawer/Drawer";import ownerDocument from"../utils/ownerDocument";import useEventCallback from"../utils/useEventCallback";import{duration}from"../styles/transitions";import useTheme from"../styles/useTheme";import{getTransitionProps}from"../transitions/utils";import NoSsr from"../NoSsr";import SwipeArea from"./SwipeArea";var UNCERTAINTY_THRESHOLD=3,nodeThatClaimedTheSwipe=null;function reset(){nodeThatClaimedTheSwipe=null}function calculateCurrentX(e,t){return"right"===e?document.body.offsetWidth-t[0].pageX:t[0].pageX}function calculateCurrentY(e,t){return"bottom"===e?window.innerHeight-t[0].clientY:t[0].clientY}function getMaxTranslate(e,t){return e?t.clientWidth:t.clientHeight}function getTranslate(e,t,r,n){return Math.min(Math.max(r?t-e:n+t-e,0),n)}function getDomTreeShapes(e,t){for(var r=[];e&&e!==t;){var n=window.getComputedStyle(e);"absolute"===n.getPropertyValue("position")||"hidden"===n.getPropertyValue("overflow-x")?r=[]:(0<e.clientWidth&&e.scrollWidth>e.clientWidth||0<e.clientHeight&&e.scrollHeight>e.clientHeight)&&r.push(e),e=e.parentElement}return r}function findNativeHandler(e){var t=e.domTreeShapes,a=e.start,o=e.current,i=e.anchor,s={x:"scrollLeft",y:"scrollTop"},c={x:"scrollWidth",y:"scrollHeight"},u={x:"clientWidth",y:"clientHeight"};return t.some(function(e){var t=a<=o,r="left"===i||"right"===i?"x":"y",n=e[s[r]],r=n+e[u[r]]<e[c[r]];return(t="top"===i||"left"===i?!t:t)&&r||!t&&0<n?e:null})}var iOS="undefined"!=typeof navigator&&/iPad|iPhone|iPod/.test(navigator.userAgent),transitionDurationDefault={enter:duration.enteringScreen,exit:duration.leavingScreen},useEnhancedEffect="undefined"!=typeof window?React.useLayoutEffect:React.useEffect,SwipeableDrawer=React.forwardRef(function(e,t){var s=useTheme(),r=getThemeProps({name:"MuiSwipeableDrawer",props:_extends({},e),theme:s}),n=r.anchor,c=void 0===n?"left":n,a=r.disableBackdropTransition,i=void 0!==a&&a,o=r.disableDiscovery,u=void 0!==o&&o,l=r.disableSwipeToOpen,p=void 0===l?iOS:l,d=r.hideBackdrop,m=r.hysteresis,f=void 0===m?.52:m,e=r.minFlingVelocity,h=void 0===e?450:e,n=r.ModalProps,a=(n=void 0===n?{}:n).BackdropProps,o=_objectWithoutProperties(n,["BackdropProps"]),T=r.onClose,v=r.onOpen,y=r.open,l=r.PaperProps,m=void 0===l?{}:l,e=r.SwipeAreaProps,n=r.swipeAreaWidth,g=void 0===n?20:n,l=r.transitionDuration,w=void 0===l?transitionDurationDefault:l,n=r.variant,P=void 0===n?"temporary":n,l=_objectWithoutProperties(r,["anchor","disableBackdropTransition","disableDiscovery","disableSwipeToOpen","hideBackdrop","hysteresis","minFlingVelocity","ModalProps","onClose","onOpen","open","PaperProps","SwipeAreaProps","swipeAreaWidth","transitionDuration","variant"]),n=React.useState(!1),r=n[0],b=n[1],S=React.useRef({isSwiping:null}),R=React.useRef(),E=React.useRef(),C=React.useRef(),D=React.useRef(!1),H=React.useRef();useEnhancedEffect(function(){H.current=null},[y]);var x=React.useCallback(function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.mode,n=void 0===r?null:r,a=t.changeTransition,o=void 0===a||a,r=getAnchor(s,c),t=-1!==["right","bottom"].indexOf(r)?1:-1,a=isHorizontal(c),r=a?"translate(".concat(t*e,"px, 0)"):"translate(0, ".concat(t*e,"px)"),t=C.current.style;t.webkitTransform=r,t.transform=r;r="";n&&(r=s.transitions.create("all",getTransitionProps({timeout:w},{mode:n}))),o&&(t.webkitTransition=r,t.transition=r),i||d||((t=E.current.style).opacity=1-e/getMaxTranslate(a,C.current),o&&(t.webkitTransition=r,t.transition=r))},[c,i,d,s,w]),A=useEventCallback(function(e){var t,r,n;D.current&&(nodeThatClaimedTheSwipe=null,D.current=!1,b(!1),S.current.isSwiping?(S.current.isSwiping=null,n=getAnchor(s,c),r=((t=isHorizontal(c))?calculateCurrentX:calculateCurrentY)(n,e.changedTouches),n=t?S.current.startX:S.current.startY,e=getMaxTranslate(t,C.current),n=(r=getTranslate(r,n,y,e))/e,Math.abs(S.current.velocity)>h&&(H.current=1e3*Math.abs((e-r)/S.current.velocity)),y?S.current.velocity>h||f<n?T():x(0,{mode:"exit"}):S.current.velocity<-h||f<1-n?v():x(getMaxTranslate(t,C.current),{mode:"enter"})):S.current.isSwiping=null)}),M=useEventCallback(function(e){if(C.current&&D.current&&(null==nodeThatClaimedTheSwipe||nodeThatClaimedTheSwipe===S.current)){var t=getAnchor(s,c),r=isHorizontal(c),n=calculateCurrentX(t,e.touches),t=calculateCurrentY(t,e.touches);if(y&&C.current.contains(e.target)&&null==nodeThatClaimedTheSwipe){var a=findNativeHandler({domTreeShapes:getDomTreeShapes(e.target,C.current),start:r?S.current.startX:S.current.startY,current:r?n:t,anchor:c});if(a)return void(nodeThatClaimedTheSwipe=a);nodeThatClaimedTheSwipe=S.current}if(null==S.current.isSwiping){var o=Math.abs(n-S.current.startX),a=Math.abs(t-S.current.startY);a<o&&e.cancelable&&e.preventDefault();var i=r?a<o&&UNCERTAINTY_THRESHOLD<o:o<a&&UNCERTAINTY_THRESHOLD<a;if(!0==i||(r?UNCERTAINTY_THRESHOLD<a:UNCERTAINTY_THRESHOLD<o)){if(!(S.current.isSwiping=i))return void A(e);S.current.startX=n,S.current.startY=t,u||y||(r?S.current.startX-=g:S.current.startY-=g)}}if(S.current.isSwiping){o=getMaxTranslate(r,C.current),i=r?S.current.startX:S.current.startY,i=getTranslate(r?n:t,i=y&&!S.current.paperHit?Math.min(i,o):i,y,o);if(y)if(S.current.paperHit)0===i&&(S.current.startX=n,S.current.startY=t);else{if(!(r?n<o:t<o))return;S.current.paperHit=!0,S.current.startX=n,S.current.startY=t}null===S.current.lastTranslate&&(S.current.lastTranslate=i,S.current.lastTime=performance.now()+1);t=(i-S.current.lastTranslate)/(performance.now()-S.current.lastTime)*1e3;S.current.velocity=.4*S.current.velocity+.6*t,S.current.lastTranslate=i,S.current.lastTime=performance.now(),e.cancelable&&e.preventDefault(),x(i)}}}),O=useEventCallback(function(e){if(!e.defaultPrevented&&!e.muiHandled&&(!y||E.current.contains(e.target)||C.current.contains(e.target))){var t=getAnchor(s,c),r=isHorizontal(c),n=calculateCurrentX(t,e.touches),t=calculateCurrentY(t,e.touches);if(!y){if(p||e.target!==R.current)return;if(r){if(g<n)return}else if(g<t)return}e.muiHandled=!0,nodeThatClaimedTheSwipe=null,S.current.startX=n,S.current.startY=t,b(!0),!y&&C.current&&x(getMaxTranslate(r,C.current)+(u?20:-g),{changeTransition:!1}),S.current.velocity=0,S.current.lastTime=null,S.current.lastTranslate=null,S.current.paperHit=!1,D.current=!0}});React.useEffect(function(){if("temporary"===P){var e=ownerDocument(C.current);return e.addEventListener("touchstart",O),e.addEventListener("touchmove",M,{passive:!1}),e.addEventListener("touchend",A),function(){e.removeEventListener("touchstart",O),e.removeEventListener("touchmove",M,{passive:!1}),e.removeEventListener("touchend",A)}}},[P,O,M,A]),React.useEffect(function(){return function(){nodeThatClaimedTheSwipe===S.current&&(nodeThatClaimedTheSwipe=null)}},[]),React.useEffect(function(){y||b(!1)},[y]);n=React.useCallback(function(e){E.current=ReactDOM.findDOMNode(e)},[]);return React.createElement(React.Fragment,null,React.createElement(Drawer,_extends({open:!("temporary"!==P||!r)||y,variant:P,ModalProps:_extends({BackdropProps:_extends({},a,{ref:n})},o),PaperProps:_extends({},m,{style:_extends({pointerEvents:"temporary"!==P||y?"":"none"},m.style),ref:C}),anchor:c,transitionDuration:H.current||w,onClose:T,ref:t},l)),!p&&"temporary"===P&&React.createElement(NoSsr,null,React.createElement(SwipeArea,_extends({anchor:c,ref:R,width:g},e))))});"production"!==process.env.NODE_ENV&&(SwipeableDrawer.propTypes={anchor:PropTypes.oneOf(["left","top","right","bottom"]),children:PropTypes.node,disableBackdropTransition:PropTypes.bool,disableDiscovery:PropTypes.bool,disableSwipeToOpen:PropTypes.bool,hideBackdrop:PropTypes.bool,hysteresis:PropTypes.number,minFlingVelocity:PropTypes.number,ModalProps:PropTypes.shape({BackdropProps:PropTypes.shape({component:elementTypeAcceptingRef})}),onClose:PropTypes.func.isRequired,onOpen:PropTypes.func.isRequired,open:PropTypes.bool.isRequired,PaperProps:PropTypes.shape({component:elementTypeAcceptingRef,style:PropTypes.object}),SwipeAreaProps:PropTypes.object,swipeAreaWidth:PropTypes.number,transitionDuration:PropTypes.oneOfType([PropTypes.number,PropTypes.shape({enter:PropTypes.number,exit:PropTypes.number})]),variant:PropTypes.oneOf(["permanent","persistent","temporary"])});export default SwipeableDrawer;export{reset};