import _toConsumableArray from"@babel/runtime/helpers/esm/toConsumableArray";import _slicedToArray from"@babel/runtime/helpers/esm/slicedToArray";import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import PropTypes from"prop-types";import clsx from"clsx";import{chainPropTypes}from"@material-ui/utils";import withStyles from"../styles/withStyles";import useTheme from"../styles/useTheme";import{alpha,lighten,darken}from"../styles/colorManipulator";import useIsFocusVisible from"../utils/useIsFocusVisible";import ownerDocument from"../utils/ownerDocument";import useEventCallback from"../utils/useEventCallback";import useForkRef from"../utils/useForkRef";import capitalize from"../utils/capitalize";import useControlled from"../utils/useControlled";import ValueLabel from"./ValueLabel";function asc(e,t){return e-t}function clamp(e,t,a){return Math.min(Math.max(t,e),a)}function findClosest(e,r){return e.reduce(function(e,t,a){t=Math.abs(r-t);return null===e||t<e.distance||t===e.distance?{distance:t,index:a}:e},null).index}function trackFinger(e,t){if(void 0!==t.current&&e.changedTouches){for(var a=0;a<e.changedTouches.length;a+=1){var r=e.changedTouches[a];if(r.identifier===t.current)return{x:r.clientX,y:r.clientY}}return!1}return{x:e.clientX,y:e.clientY}}function valueToPercent(e,t,a){return 100*(e-t)/(a-t)}function percentToValue(e,t,a){return(a-t)*e+t}function getDecimalPrecision(e){if(Math.abs(e)<1){var t=e.toExponential().split("e-"),a=t[0].split(".")[1];return(a?a.length:0)+parseInt(t[1],10)}e=e.toString().split(".")[1];return e?e.length:0}function roundValueToStep(e,t,a){a=Math.round((e-a)/t)*t+a;return Number(a.toFixed(getDecimalPrecision(t)))}function setValueIndex(e){var t=e.values,a=e.source,r=e.newValue,e=e.index;if(t[e]===r)return a;t=t.slice();return t[e]=r,t}function focusThumb(e){var t=e.sliderRef,a=e.activeIndex,e=e.setActive;t.current.contains(document.activeElement)&&Number(document.activeElement.getAttribute("data-index"))===a||t.current.querySelector('[role="slider"][data-index="'.concat(a,'"]')).focus(),e&&e(a)}var axisProps={horizontal:{offset:function(e){return{left:"".concat(e,"%")}},leap:function(e){return{width:"".concat(e,"%")}}},"horizontal-reverse":{offset:function(e){return{right:"".concat(e,"%")}},leap:function(e){return{width:"".concat(e,"%")}}},vertical:{offset:function(e){return{bottom:"".concat(e,"%")}},leap:function(e){return{height:"".concat(e,"%")}}}},Identity=function(e){return e},styles=function(e){return{root:{height:2,width:"100%",boxSizing:"content-box",padding:"13px 0",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",color:e.palette.primary.main,WebkitTapHighlightColor:"transparent","&$disabled":{pointerEvents:"none",cursor:"default",color:e.palette.grey[400]},"&$vertical":{width:2,height:"100%",padding:"0 13px"},"@media (pointer: coarse)":{padding:"20px 0","&$vertical":{padding:"0 20px"}},"@media print":{colorAdjust:"exact"}},colorPrimary:{},colorSecondary:{color:e.palette.secondary.main},marked:{marginBottom:20,"&$vertical":{marginBottom:"auto",marginRight:20}},vertical:{},disabled:{},rail:{display:"block",position:"absolute",width:"100%",height:2,borderRadius:1,backgroundColor:"currentColor",opacity:.38,"$vertical &":{height:"100%",width:2}},track:{display:"block",position:"absolute",height:2,borderRadius:1,backgroundColor:"currentColor","$vertical &":{width:2}},trackFalse:{"& $track":{display:"none"}},trackInverted:{"& $track":{backgroundColor:"light"===e.palette.type?lighten(e.palette.primary.main,.62):darken(e.palette.primary.main,.5)},"& $rail":{opacity:1}},thumb:{position:"absolute",width:12,height:12,marginLeft:-6,marginTop:-5,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow"],{duration:e.transitions.duration.shortest}),"&::after":{position:"absolute",content:'""',borderRadius:"50%",left:-15,top:-15,right:-15,bottom:-15},"&$focusVisible,&:hover":{boxShadow:"0px 0px 0px 8px ".concat(alpha(e.palette.primary.main,.16)),"@media (hover: none)":{boxShadow:"none"}},"&$active":{boxShadow:"0px 0px 0px 14px ".concat(alpha(e.palette.primary.main,.16))},"&$disabled":{width:8,height:8,marginLeft:-4,marginTop:-3,"&:hover":{boxShadow:"none"}},"$vertical &":{marginLeft:-5,marginBottom:-6},"$vertical &$disabled":{marginLeft:-3,marginBottom:-4}},thumbColorPrimary:{},thumbColorSecondary:{"&$focusVisible,&:hover":{boxShadow:"0px 0px 0px 8px ".concat(alpha(e.palette.secondary.main,.16))},"&$active":{boxShadow:"0px 0px 0px 14px ".concat(alpha(e.palette.secondary.main,.16))}},active:{},focusVisible:{},valueLabel:{left:"calc(-50% - 4px)"},mark:{position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor"},markActive:{backgroundColor:e.palette.background.paper,opacity:.8},markLabel:_extends({},e.typography.body2,{color:e.palette.text.secondary,position:"absolute",top:26,transform:"translateX(-50%)",whiteSpace:"nowrap","$vertical &":{top:"auto",left:26,transform:"translateY(50%)"},"@media (pointer: coarse)":{top:40,"$vertical &":{left:31}}}),markLabelActive:{color:e.palette.text.primary}}},Slider=React.forwardRef(function(e,t){var r=e["aria-label"],o=e["aria-labelledby"],n=e["aria-valuetext"],i=e.classes,a=e.className,l=e.color,s=void 0===l?"primary":l,u=e.component,c=void 0===u?"span":u,p=e.defaultValue,d=e.disabled,m=void 0!==d&&d,v=e.getAriaLabel,f=e.getAriaValueText,b=e.marks,h=void 0!==b&&b,l=e.max,y=void 0===l?100:l,u=e.min,g=void 0===u?0:u,d=e.name,x=e.onChange,T=e.onChangeCommitted,k=e.onMouseDown,b=e.orientation,P=void 0===b?"horizontal":b,l=e.scale,w=void 0===l?Identity:l,u=e.step,C=void 0===u?1:u,b=e.ThumbComponent,L=void 0===b?"span":b,l=e.track,E=void 0===l?"normal":l,u=e.value,b=e.ValueLabelComponent,R=void 0===b?ValueLabel:b,l=e.valueLabelDisplay,A=void 0===l?"off":l,b=e.valueLabelFormat,V=void 0===b?Identity:b,l=_objectWithoutProperties(e,["aria-label","aria-labelledby","aria-valuetext","classes","className","color","component","defaultValue","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","onMouseDown","orientation","scale","step","ThumbComponent","track","value","ValueLabelComponent","valueLabelDisplay","valueLabelFormat"]),b=useTheme(),S=React.useRef(),e=React.useState(-1),I=e[0],D=e[1],e=React.useState(-1),F=e[0],$=e[1],p=useControlled({controlled:u,default:p,name:"Slider"}),p=_slicedToArray(p,2),O=p[0],N=p[1],M=Array.isArray(O),_=(_=M?O.slice().sort(asc):[O]).map(function(e){return clamp(e,g,y)}),z=!0===h&&null!==C?_toConsumableArray(Array(Math.floor((y-g)/C)+1)).map(function(e,t){return{value:g+C*t}}):h||[],p=useIsFocusVisible(),j=p.isFocusVisible,B=p.onBlurVisible,h=p.ref,p=React.useState(-1),Y=p[0],U=p[1],W=React.useRef(),p=useForkRef(h,W),h=useForkRef(t,p),X=useEventCallback(function(e){var t=Number(e.currentTarget.getAttribute("data-index"));j(e)&&U(t),$(t)}),q=useEventCallback(function(){-1!==Y&&(U(-1),B()),$(-1)}),H=useEventCallback(function(e){e=Number(e.currentTarget.getAttribute("data-index"));$(e)}),K=useEventCallback(function(){$(-1)}),G="rtl"===b.direction,J=useEventCallback(function(e){var t,a,r=Number(e.currentTarget.getAttribute("data-index")),o=_[r],n=(y-g)/10,i=z.map(function(e){return e.value}),l=i.indexOf(o);switch(e.key){case"Home":a=g;break;case"End":a=y;break;case"PageUp":C&&(a=o+n);break;case"PageDown":C&&(a=o-n);break;case G?"ArrowLeft":"ArrowRight":case"ArrowUp":a=C?o+C:i[l+1]||i[i.length-1];break;case G?"ArrowRight":"ArrowLeft":case"ArrowDown":a=C?o-C:i[l-1]||i[0];break;default:return}e.preventDefault(),a=clamp(a=C?roundValueToStep(a,C,g):a,g,y),M&&(a=setValueIndex({values:_,source:O,newValue:t=a,index:r}).sort(asc),focusThumb({sliderRef:W,activeIndex:a.indexOf(t)})),N(a),U(r),x&&x(e,a),T&&T(e,a)}),Q=React.useRef(),Z=P;G&&"vertical"!==P&&(Z+="-reverse");function ee(e){var t=e.finger,a=void 0!==(i=e.move)&&i,r=e.values,o=e.source,n=(l=W.current.getBoundingClientRect()).width,i=l.height,e=l.bottom,l=l.left,n=0===Z.indexOf("vertical")?(e-t.y)/i:(t.x-l)/n;n=percentToValue(n=-1!==Z.indexOf("-reverse")?1-n:n,g,y),n=clamp(n=C?roundValueToStep(n,C,g):(s=z.map(function(e){return e.value}))[findClosest(s,n)],g,y);var s=0;return M&&(s=(n=setValueIndex({values:r,source:o,newValue:o=n,index:s=a?Q.current:findClosest(r,n)}).sort(asc)).indexOf(o),Q.current=s),{newValue:n,activeIndex:s}}var te=useEventCallback(function(e){var t,a=trackFinger(e,S);a&&(a=(t=ee({finger:a,move:!0,values:_,source:O})).newValue,t=t.activeIndex,focusThumb({sliderRef:W,activeIndex:t,setActive:D}),N(a),x&&x(e,a))}),ae=useEventCallback(function(e){var t=trackFinger(e,S);t&&(t=ee({finger:t,values:_,source:O}).newValue,D(-1),"touchend"===e.type&&$(-1),T&&T(e,t),S.current=void 0,(t=ownerDocument(W.current)).removeEventListener("mousemove",te),t.removeEventListener("mouseup",ae),t.removeEventListener("touchmove",te),t.removeEventListener("touchend",ae))}),re=useEventCallback(function(e){e.preventDefault();var t=e.changedTouches[0];null!=t&&(S.current=t.identifier);var a=trackFinger(e,S),t=ee({finger:a,values:_,source:O}),a=t.newValue,t=t.activeIndex;focusThumb({sliderRef:W,activeIndex:t,setActive:D}),N(a),x&&x(e,a);a=ownerDocument(W.current);a.addEventListener("touchmove",te),a.addEventListener("touchend",ae)});React.useEffect(function(){var e=W.current;e.addEventListener("touchstart",re);var t=ownerDocument(e);return function(){e.removeEventListener("touchstart",re),t.removeEventListener("mousemove",te),t.removeEventListener("mouseup",ae),t.removeEventListener("touchmove",te),t.removeEventListener("touchend",ae)}},[ae,te,re]);t=useEventCallback(function(e){k&&k(e),e.preventDefault();var t=trackFinger(e,S),a=ee({finger:t,values:_,source:O}),t=a.newValue,a=a.activeIndex;focusThumb({sliderRef:W,activeIndex:a,setActive:D}),N(t),x&&x(e,t);t=ownerDocument(W.current);t.addEventListener("mousemove",te),t.addEventListener("mouseup",ae)}),p=valueToPercent(M?_[0]:g,g,y),b=valueToPercent(_[_.length-1],g,y)-p,b=_extends({},axisProps[Z].offset(p),axisProps[Z].leap(b));return React.createElement(c,_extends({ref:h,className:clsx(i.root,i["color".concat(capitalize(s))],a,m&&i.disabled,0<z.length&&z.some(function(e){return e.label})&&i.marked,!1===E&&i.trackFalse,"vertical"===P&&i.vertical,"inverted"===E&&i.trackInverted),onMouseDown:t},l),React.createElement("span",{className:i.rail}),React.createElement("span",{className:i.track,style:b}),React.createElement("input",{value:_.join(","),name:d,type:"hidden"}),z.map(function(e,t){var a=valueToPercent(e.value,g,y),r=axisProps[Z].offset(a),a=!1===E?-1!==_.indexOf(e.value):"normal"===E&&(M?e.value>=_[0]&&e.value<=_[_.length-1]:e.value<=_[0])||"inverted"===E&&(M?e.value<=_[0]||e.value>=_[_.length-1]:e.value>=_[0]);return React.createElement(React.Fragment,{key:e.value},React.createElement("span",{style:r,"data-index":t,className:clsx(i.mark,a&&i.markActive)}),null!=e.label?React.createElement("span",{"aria-hidden":!0,"data-index":t,style:r,className:clsx(i.markLabel,a&&i.markLabelActive)},e.label):null)}),_.map(function(e,t){var a=valueToPercent(e,g,y),a=axisProps[Z].offset(a);return React.createElement(R,{key:t,valueLabelFormat:V,valueLabelDisplay:A,className:i.valueLabel,value:"function"==typeof V?V(w(e),t):V,index:t,open:F===t||I===t||"on"===A,disabled:m},React.createElement(L,{className:clsx(i.thumb,i["thumbColor".concat(capitalize(s))],I===t&&i.active,m&&i.disabled,Y===t&&i.focusVisible),tabIndex:m?null:0,role:"slider",style:a,"data-index":t,"aria-label":v?v(t):r,"aria-labelledby":o,"aria-orientation":P,"aria-valuemax":w(y),"aria-valuemin":w(g),"aria-valuenow":w(e),"aria-valuetext":f?f(w(e),t):n,onKeyDown:J,onFocus:X,onBlur:q,onMouseOver:H,onMouseLeave:K}))}))});"production"!==process.env.NODE_ENV&&(Slider.propTypes={"aria-label":chainPropTypes(PropTypes.string,function(e){return Array.isArray(e.value||e.defaultValue)&&null!=e["aria-label"]?new Error("Material-UI: You need to use the `getAriaLabel` prop instead of `aria-label` when using a range slider."):null}),"aria-labelledby":PropTypes.string,"aria-valuetext":chainPropTypes(PropTypes.string,function(e){return Array.isArray(e.value||e.defaultValue)&&null!=e["aria-valuetext"]?new Error("Material-UI: You need to use the `getAriaValueText` prop instead of `aria-valuetext` when using a range slider."):null}),classes:PropTypes.object.isRequired,className:PropTypes.string,color:PropTypes.oneOf(["primary","secondary"]),component:PropTypes.elementType,defaultValue:PropTypes.oneOfType([PropTypes.number,PropTypes.arrayOf(PropTypes.number)]),disabled:PropTypes.bool,getAriaLabel:PropTypes.func,getAriaValueText:PropTypes.func,marks:PropTypes.oneOfType([PropTypes.bool,PropTypes.array]),max:PropTypes.number,min:PropTypes.number,name:PropTypes.string,onChange:PropTypes.func,onChangeCommitted:PropTypes.func,onMouseDown:PropTypes.func,orientation:PropTypes.oneOf(["horizontal","vertical"]),scale:PropTypes.func,step:PropTypes.number,ThumbComponent:PropTypes.elementType,track:PropTypes.oneOf(["normal",!1,"inverted"]),value:PropTypes.oneOfType([PropTypes.number,PropTypes.arrayOf(PropTypes.number)]),ValueLabelComponent:PropTypes.elementType,valueLabelDisplay:PropTypes.oneOf(["on","auto","off"]),valueLabelFormat:PropTypes.oneOfType([PropTypes.string,PropTypes.func])});export default withStyles(styles,{name:"MuiSlider"})(Slider);export{styles};