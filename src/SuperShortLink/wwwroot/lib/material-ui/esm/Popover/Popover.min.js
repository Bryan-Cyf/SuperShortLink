import _extends from"@babel/runtime/helpers/esm/extends";import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import*as React from"react";import PropTypes from"prop-types";import*as ReactDOM from"react-dom";import{chainPropTypes,elementTypeAcceptingRef,refType,HTMLElementType}from"@material-ui/utils";import debounce from"../utils/debounce";import clsx from"clsx";import ownerDocument from"../utils/ownerDocument";import ownerWindow from"../utils/ownerWindow";import createChainedFunction from"../utils/createChainedFunction";import deprecatedPropType from"../utils/deprecatedPropType";import withStyles from"../styles/withStyles";import Modal from"../Modal";import Grow from"../Grow";import Paper from"../Paper";function getOffsetTop(e,o){var n=0;return"number"==typeof o?n=o:"center"===o?n=e.height/2:"bottom"===o&&(n=e.height),n}function getOffsetLeft(e,o){var n=0;return"number"==typeof o?n=o:"center"===o?n=e.width/2:"right"===o&&(n=e.width),n}function getTransformOriginValue(e){return[e.horizontal,e.vertical].map(function(e){return"number"==typeof e?"".concat(e,"px"):e}).join(" ")}function getScrollParent(e,o){for(var n=o,t=0;n&&n!==e;)t+=(n=n.parentElement).scrollTop;return t}function getAnchorEl(e){return"function"==typeof e?e():e}var styles={root:{},paper:{position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}},Popover=React.forwardRef(function(e,o){var n=e.action,c=e.anchorEl,t=e.anchorOrigin,r=void 0===t?{vertical:"top",horizontal:"left"}:t,i=e.anchorPosition,p=e.anchorReference,l=void 0===p?"anchorEl":p,a=e.children,s=e.classes,u=e.className,h=e.container,f=e.elevation,d=void 0===f?8:f,m=e.getContentAnchorEl,T=e.marginThreshold,y=void 0===T?16:T,P=e.onEnter,g=e.onEntered,v=e.onEntering,E=e.onExit,b=e.onExited,O=e.onExiting,R=e.open,x=e.PaperProps,t=void 0===x?{}:x,p=e.transformOrigin,w=void 0===p?{vertical:"top",horizontal:"left"}:p,f=e.TransitionComponent,T=void 0===f?Grow:f,x=e.transitionDuration,p=void 0===x?"auto":x,f=e.TransitionProps,x=void 0===f?{}:f,f=_objectWithoutProperties(e,["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","classes","className","container","elevation","getContentAnchorEl","marginThreshold","onEnter","onEntered","onEntering","onExit","onExited","onExiting","open","PaperProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"]),C=React.useRef(),N=React.useCallback(function(e){if("anchorPosition"===l)return"production"!==process.env.NODE_ENV&&(i||console.error('Material-UI: You need to provide a `anchorPosition` prop when using <Popover anchorReference="anchorPosition" />.')),i;var o=getAnchorEl(c),n=o&&1===o.nodeType?o:ownerDocument(C.current).body,o=n.getBoundingClientRect();"production"!==process.env.NODE_ENV&&(n=n.getBoundingClientRect(),"test"!==process.env.NODE_ENV&&0===n.top&&0===n.left&&0===n.right&&0===n.bottom&&console.warn(["Material-UI: The `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n")));e=0===e?r.vertical:"center";return{top:o.top+getOffsetTop(o,e),left:o.left+getOffsetLeft(o,r.horizontal)}},[c,r.horizontal,r.vertical,i,l]),M=React.useCallback(function(e){var o,n=0;return m&&"anchorEl"===l&&((o=m(e))&&e.contains(o)&&(e=getScrollParent(e,o),n=o.offsetTop+o.clientHeight/2-e||0),"production"!==process.env.NODE_ENV&&"top"!==r.vertical&&console.error(["Material-UI: You can not change the default `anchorOrigin.vertical` value ","when also providing the `getContentAnchorEl` prop to the popover component.","Only use one of the two props.","Set `getContentAnchorEl` to `null | undefined` or leave `anchorOrigin.vertical` unchanged."].join("\n"))),n},[r.vertical,l,m]),D=React.useCallback(function(e){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return{vertical:getOffsetTop(e,w.vertical)+o,horizontal:getOffsetLeft(e,w.horizontal)}},[w.horizontal,w.vertical]),z=React.useCallback(function(e){var o=M(e),n={width:e.offsetWidth,height:e.offsetHeight},t=D(n,o);if("none"===l)return{top:null,left:null,transformOrigin:getTransformOriginValue(t)};var r=N(o),i=r.top-t.vertical,p=r.left-t.horizontal,a=i+n.height,s=p+n.width,e=ownerWindow(getAnchorEl(c)),o=e.innerHeight-y,r=e.innerWidth-y;return i<y?(i-=e=i-y,t.vertical+=e):o<a&&(i-=a=a-o,t.vertical+=a),"production"!==process.env.NODE_ENV&&o<n.height&&n.height&&o&&console.error(["Material-UI: The popover component is too tall.","Some part of it can not be seen on the screen (".concat(n.height-o,"px)."),"Please consider adding a `max-height` to improve the user-experience."].join("\n")),p<y?(p-=o=p-y,t.horizontal+=o):r<s&&(p-=r=s-r,t.horizontal+=r),{top:"".concat(Math.round(i),"px"),left:"".concat(Math.round(p),"px"),transformOrigin:getTransformOriginValue(t)}},[c,l,N,M,D,y]),A=React.useCallback(function(){var e,o=C.current;o&&(null!==(e=z(o)).top&&(o.style.top=e.top),null!==e.left&&(o.style.left=e.left),o.style.transformOrigin=e.transformOrigin)},[z]),e=React.useCallback(function(e){C.current=ReactDOM.findDOMNode(e)},[]);React.useEffect(function(){R&&A()}),React.useImperativeHandle(n,function(){return R?{updatePosition:function(){A()}}:null},[R,A]),React.useEffect(function(){if(R){var e=debounce(function(){A()});return window.addEventListener("resize",e),function(){e.clear(),window.removeEventListener("resize",e)}}},[R,A]);n=p;"auto"!==p||T.muiSupportAuto||(n=void 0);h=h||(c?ownerDocument(getAnchorEl(c)).body:void 0);return React.createElement(Modal,_extends({container:h,open:R,ref:o,BackdropProps:{invisible:!0},className:clsx(s.root,u)},f),React.createElement(T,_extends({appear:!0,in:R,onEnter:P,onEntered:g,onExit:E,onExited:b,onExiting:O,timeout:n},x,{onEntering:createChainedFunction(function(e,o){v&&v(e,o),A()},x.onEntering)}),React.createElement(Paper,_extends({elevation:d,ref:e},t,{className:clsx(s.paper,t.className)}),a)))});"production"!==process.env.NODE_ENV&&(Popover.propTypes={action:refType,anchorEl:chainPropTypes(PropTypes.oneOfType([HTMLElementType,PropTypes.func]),function(e){if(e.open&&(!e.anchorReference||"anchorEl"===e.anchorReference)){e=getAnchorEl(e.anchorEl);if(!e||1!==e.nodeType)return new Error(["Material-UI: The `anchorEl` prop provided to the component is invalid.","It should be an Element instance but it's `".concat(e,"` instead.")].join("\n"));e=e.getBoundingClientRect();if("test"!==process.env.NODE_ENV&&0===e.top&&0===e.left&&0===e.right&&0===e.bottom)return new Error(["Material-UI: The `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}return null}),anchorOrigin:PropTypes.shape({horizontal:PropTypes.oneOfType([PropTypes.oneOf(["center","left","right"]),PropTypes.number]).isRequired,vertical:PropTypes.oneOfType([PropTypes.oneOf(["bottom","center","top"]),PropTypes.number]).isRequired}),anchorPosition:PropTypes.shape({left:PropTypes.number.isRequired,top:PropTypes.number.isRequired}),anchorReference:PropTypes.oneOf(["anchorEl","anchorPosition","none"]),children:PropTypes.node,classes:PropTypes.object,className:PropTypes.string,container:PropTypes.oneOfType([HTMLElementType,PropTypes.instanceOf(React.Component),PropTypes.func]),elevation:PropTypes.number,getContentAnchorEl:PropTypes.func,marginThreshold:PropTypes.number,onClose:PropTypes.func,onEnter:deprecatedPropType(PropTypes.func,"Use the `TransitionProps` prop instead."),onEntered:deprecatedPropType(PropTypes.func,"Use the `TransitionProps` prop instead."),onEntering:deprecatedPropType(PropTypes.func,"Use the `TransitionProps` prop instead."),onExit:deprecatedPropType(PropTypes.func,"Use the `TransitionProps` prop instead."),onExited:deprecatedPropType(PropTypes.func,"Use the `TransitionProps` prop instead."),onExiting:deprecatedPropType(PropTypes.func,"Use the `TransitionProps` prop instead."),open:PropTypes.bool.isRequired,PaperProps:PropTypes.shape({component:elementTypeAcceptingRef}),transformOrigin:PropTypes.shape({horizontal:PropTypes.oneOfType([PropTypes.oneOf(["center","left","right"]),PropTypes.number]).isRequired,vertical:PropTypes.oneOfType([PropTypes.oneOf(["bottom","center","top"]),PropTypes.number]).isRequired}),TransitionComponent:PropTypes.elementType,transitionDuration:PropTypes.oneOfType([PropTypes.oneOf(["auto"]),PropTypes.number,PropTypes.shape({appear:PropTypes.number,enter:PropTypes.number,exit:PropTypes.number})]),TransitionProps:PropTypes.object});export default withStyles(styles,{name:"MuiPopover"})(Popover);export{getOffsetTop,getOffsetLeft,styles};