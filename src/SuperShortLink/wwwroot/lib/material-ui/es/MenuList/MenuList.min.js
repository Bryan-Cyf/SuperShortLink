import _extends from"@babel/runtime/helpers/esm/extends";import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import*as React from"react";import{isFragment}from"react-is";import PropTypes from"prop-types";import*as ReactDOM from"react-dom";import ownerDocument from"../utils/ownerDocument";import List from"../List";import getScrollbarSize from"../utils/getScrollbarSize";import useForkRef from"../utils/useForkRef";function nextItem(e,t,r){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:r?null:e.firstChild}function previousItem(e,t,r){return e===t?r?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:r?null:e.lastChild}function textCriteriaMatches(e,t){if(void 0===t)return!0;let r=e.innerText;return void 0===r&&(r=e.textContent),r=r.trim().toLowerCase(),0!==r.length&&(t.repeating?r[0]===t.keys[0]:0===r.indexOf(t.keys.join("")))}function moveFocus(e,t,r,o,n,s){let i=!1,a=n(e,t,!!t&&r);for(;a;){if(a===e.firstChild){if(i)return;i=!0}var c=!o&&(a.disabled||"true"===a.getAttribute("aria-disabled"));if(a.hasAttribute("tabindex")&&textCriteriaMatches(a,s)&&!c)return void a.focus();a=n(e,a,r)}}const useEnhancedEffect="undefined"==typeof window?React.useEffect:React.useLayoutEffect,MenuList=React.forwardRef(function(e,t){const{actions:r,autoFocus:o=!1,autoFocusItem:n=!1,children:s,className:i,disabledItemsFocusable:a=!1,disableListWrap:c=!1,onKeyDown:l,variant:u="selectedMenu"}=e,p=_objectWithoutPropertiesLoose(e,["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"]),d=React.useRef(null),m=React.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});useEnhancedEffect(()=>{o&&d.current.focus()},[o]),React.useImperativeHandle(r,()=>({adjustStyleForScrollbar:(e,t)=>{var r=!d.current.style.width;return e.clientHeight<d.current.clientHeight&&r&&(r=`${getScrollbarSize(!0)}px`,d.current.style["rtl"===t.direction?"paddingLeft":"paddingRight"]=r,d.current.style.width=`calc(100% + ${r})`),d.current}}),[]);e=React.useCallback(e=>{d.current=ReactDOM.findDOMNode(e)},[]),e=useForkRef(e,t);let f=-1;React.Children.forEach(s,(e,t)=>{React.isValidElement(e)&&("production"!==process.env.NODE_ENV&&isFragment(e)&&console.error(["Material-UI: The Menu component doesn't accept a Fragment as a child.","Consider providing an array instead."].join("\n")),e.props.disabled||("selectedMenu"===u&&e.props.selected||-1===f)&&(f=t))});t=React.Children.map(s,(e,t)=>{if(t!==f)return e;{const r={};return n&&(r.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===u&&(r.tabIndex=0),React.cloneElement(e,r)}});return React.createElement(List,_extends({role:"menu",ref:e,className:i,onKeyDown:e=>{var t=d.current;const r=e.key;var o=ownerDocument(t).activeElement;if("ArrowDown"===r)e.preventDefault(),moveFocus(t,o,c,a,nextItem);else if("ArrowUp"===r)e.preventDefault(),moveFocus(t,o,c,a,previousItem);else if("Home"===r)e.preventDefault(),moveFocus(t,null,c,a,nextItem);else if("End"===r)e.preventDefault(),moveFocus(t,null,c,a,previousItem);else if(1===r.length){const i=m.current;var n=r.toLowerCase(),s=performance.now();0<i.keys.length&&(500<s-i.lastTime?(i.keys=[],i.repeating=!0,i.previousKeyMatched=!0):i.repeating&&n!==i.keys[0]&&(i.repeating=!1)),i.lastTime=s,i.keys.push(n);n=o&&!i.repeating&&textCriteriaMatches(o,i);i.previousKeyMatched&&(n||moveFocus(t,o,!1,a,nextItem,i))?e.preventDefault():i.previousKeyMatched=!1}l&&l(e)},tabIndex:o?0:-1},p),t)});"production"!==process.env.NODE_ENV&&(MenuList.propTypes={autoFocus:PropTypes.bool,autoFocusItem:PropTypes.bool,children:PropTypes.node,className:PropTypes.string,disabledItemsFocusable:PropTypes.bool,disableListWrap:PropTypes.bool,onKeyDown:PropTypes.func,variant:PropTypes.oneOf(["menu","selectedMenu"])});export default MenuList;