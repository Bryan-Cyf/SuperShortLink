import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import PropTypes from"prop-types";import*as ReactDOM from"react-dom";import{elementTypeAcceptingRef}from"@material-ui/utils";import{getThemeProps}from"@material-ui/styles";import Drawer,{getAnchor,isHorizontal}from"../Drawer/Drawer";import ownerDocument from"../utils/ownerDocument";import useEventCallback from"../utils/useEventCallback";import{duration}from"../styles/transitions";import useTheme from"../styles/useTheme";import{getTransitionProps}from"../transitions/utils";import NoSsr from"../NoSsr";import SwipeArea from"./SwipeArea";const UNCERTAINTY_THRESHOLD=3;let nodeThatClaimedTheSwipe=null;function reset(){nodeThatClaimedTheSwipe=null}function calculateCurrentX(e,t){return"right"===e?document.body.offsetWidth-t[0].pageX:t[0].pageX}function calculateCurrentY(e,t){return"bottom"===e?window.innerHeight-t[0].clientY:t[0].clientY}function getMaxTranslate(e,t){return e?t.clientWidth:t.clientHeight}function getTranslate(e,t,r,n){return Math.min(Math.max(r?t-e:n+t-e,0),n)}function getDomTreeShapes(e,t){let r=[];for(;e&&e!==t;){const n=window.getComputedStyle(e);"absolute"===n.getPropertyValue("position")||"hidden"===n.getPropertyValue("overflow-x")?r=[]:(0<e.clientWidth&&e.scrollWidth>e.clientWidth||0<e.clientHeight&&e.scrollHeight>e.clientHeight)&&r.push(e),e=e.parentElement}return r}function findNativeHandler({domTreeShapes:e,start:o,current:i,anchor:s}){const c={scrollPosition:{x:"scrollLeft",y:"scrollTop"},scrollLength:{x:"scrollWidth",y:"scrollHeight"},clientLength:{x:"clientWidth",y:"clientHeight"}};return e.some(e=>{let t=o<=i;"top"!==s&&"left"!==s||(t=!t);var r="left"===s||"right"===s?"x":"y",n=e[c.scrollPosition[r]],a=0<n,r=n+e[c.clientLength[r]]<e[c.scrollLength[r]];return t&&r||!t&&a?e:null})}const iOS="undefined"!=typeof navigator&&/iPad|iPhone|iPod/.test(navigator.userAgent),transitionDurationDefault={enter:duration.enteringScreen,exit:duration.leavingScreen},useEnhancedEffect="undefined"!=typeof window?React.useLayoutEffect:React.useEffect,SwipeableDrawer=React.forwardRef(function(e,t){const c=useTheme();e=getThemeProps({name:"MuiSwipeableDrawer",props:_extends({},e),theme:c});const{anchor:l="left",disableBackdropTransition:u=!1,disableDiscovery:s=!1,disableSwipeToOpen:a=iOS,hideBackdrop:p,hysteresis:o=.52,minFlingVelocity:i=450,ModalProps:{BackdropProps:r}={},onClose:d,onOpen:m,open:h,PaperProps:n={},SwipeAreaProps:T,swipeAreaWidth:f=20,transitionDuration:y=transitionDurationDefault,variant:g="temporary"}=e,w=_objectWithoutPropertiesLoose(e.ModalProps,["BackdropProps"]),P=_objectWithoutPropertiesLoose(e,["anchor","disableBackdropTransition","disableDiscovery","disableSwipeToOpen","hideBackdrop","hysteresis","minFlingVelocity","ModalProps","onClose","onOpen","open","PaperProps","SwipeAreaProps","swipeAreaWidth","transitionDuration","variant"]),[b,v]=React.useState(!1),S=React.useRef({isSwiping:null}),R=React.useRef(),E=React.useRef(),C=React.useRef(),D=React.useRef(!1),H=React.useRef();useEnhancedEffect(()=>{H.current=null},[h]);const x=React.useCallback((e,t={})=>{var{mode:r=null,changeTransition:n=!0}=t,a=getAnchor(c,l),t=-1!==["right","bottom"].indexOf(a)?1:-1,a=isHorizontal(l),t=a?`translate(${t*e}px, 0)`:`translate(0, ${t*e}px)`;const o=C.current.style;o.webkitTransform=t,o.transform=t;let i="";if(r&&(i=c.transitions.create("all",getTransitionProps({timeout:y},{mode:r}))),n&&(o.webkitTransition=i,o.transition=i),!u&&!p){const s=E.current.style;s.opacity=1-e/getMaxTranslate(a,C.current),n&&(s.webkitTransition=i,s.transition=i)}},[l,u,p,c,y]),A=useEventCallback(t=>{if(D.current)if(nodeThatClaimedTheSwipe=null,D.current=!1,v(!1),S.current.isSwiping){S.current.isSwiping=null;var r=getAnchor(c,l),n=isHorizontal(l);let e;e=(n?calculateCurrentX:calculateCurrentY)(r,t.changedTouches);var a=n?S.current.startX:S.current.startY,r=getMaxTranslate(n,C.current),t=getTranslate(e,a,h,r),a=t/r;Math.abs(S.current.velocity)>i&&(H.current=1e3*Math.abs((r-t)/S.current.velocity)),h?S.current.velocity>i||a>o?d():x(0,{mode:"exit"}):S.current.velocity<-i||1-a>o?m():x(getMaxTranslate(n,C.current),{mode:"enter"})}else S.current.isSwiping=null}),M=useEventCallback(t=>{if(C.current&&D.current&&(null==nodeThatClaimedTheSwipe||nodeThatClaimedTheSwipe===S.current)){var r=getAnchor(c,l),n=isHorizontal(l),a=calculateCurrentX(r,t.touches),r=calculateCurrentY(r,t.touches);if(h&&C.current.contains(t.target)&&null==nodeThatClaimedTheSwipe){var e=findNativeHandler({domTreeShapes:getDomTreeShapes(t.target,C.current),start:n?S.current.startX:S.current.startY,current:n?a:r,anchor:l});if(e)return void(nodeThatClaimedTheSwipe=e);nodeThatClaimedTheSwipe=S.current}if(null==S.current.isSwiping){var o=Math.abs(a-S.current.startX),e=Math.abs(r-S.current.startY);e<o&&t.cancelable&&t.preventDefault();var i=n?e<o&&o>UNCERTAINTY_THRESHOLD:o<e&&e>UNCERTAINTY_THRESHOLD;if(!0==i||(n?e>UNCERTAINTY_THRESHOLD:o>UNCERTAINTY_THRESHOLD)){if(!(S.current.isSwiping=i))return void A(t);S.current.startX=a,S.current.startY=r,s||h||(n?S.current.startX-=f:S.current.startY-=f)}}if(S.current.isSwiping){o=getMaxTranslate(n,C.current);let e=n?S.current.startX:S.current.startY;h&&!S.current.paperHit&&(e=Math.min(e,o));i=getTranslate(n?a:r,e,h,o);if(h)if(S.current.paperHit)0===i&&(S.current.startX=a,S.current.startY=r);else{if(!(n?a<o:r<o))return;S.current.paperHit=!0,S.current.startX=a,S.current.startY=r}null===S.current.lastTranslate&&(S.current.lastTranslate=i,S.current.lastTime=performance.now()+1);r=(i-S.current.lastTranslate)/(performance.now()-S.current.lastTime)*1e3;S.current.velocity=.4*S.current.velocity+.6*r,S.current.lastTranslate=i,S.current.lastTime=performance.now(),t.cancelable&&t.preventDefault(),x(i)}}}),L=useEventCallback(e=>{if(!e.defaultPrevented&&!e.muiHandled&&(!h||E.current.contains(e.target)||C.current.contains(e.target))){var t=getAnchor(c,l),r=isHorizontal(l),n=calculateCurrentX(t,e.touches),t=calculateCurrentY(t,e.touches);if(!h){if(a||e.target!==R.current)return;if(r){if(n>f)return}else if(t>f)return}e.muiHandled=!0,nodeThatClaimedTheSwipe=null,S.current.startX=n,S.current.startY=t,v(!0),!h&&C.current&&x(getMaxTranslate(r,C.current)+(s?20:-f),{changeTransition:!1}),S.current.velocity=0,S.current.lastTime=null,S.current.lastTranslate=null,S.current.paperHit=!1,D.current=!0}});React.useEffect(()=>{if("temporary"===g){const e=ownerDocument(C.current);return e.addEventListener("touchstart",L),e.addEventListener("touchmove",M,{passive:!1}),e.addEventListener("touchend",A),()=>{e.removeEventListener("touchstart",L),e.removeEventListener("touchmove",M,{passive:!1}),e.removeEventListener("touchend",A)}}},[g,L,M,A]),React.useEffect(()=>()=>{nodeThatClaimedTheSwipe===S.current&&(nodeThatClaimedTheSwipe=null)},[]),React.useEffect(()=>{h||v(!1)},[h]);e=React.useCallback(e=>{E.current=ReactDOM.findDOMNode(e)},[]);return React.createElement(React.Fragment,null,React.createElement(Drawer,_extends({open:!("temporary"!==g||!b)||h,variant:g,ModalProps:_extends({BackdropProps:_extends({},r,{ref:e})},w),PaperProps:_extends({},n,{style:_extends({pointerEvents:"temporary"!==g||h?"":"none"},n.style),ref:C}),anchor:l,transitionDuration:H.current||y,onClose:d,ref:t},P)),!a&&"temporary"===g&&React.createElement(NoSsr,null,React.createElement(SwipeArea,_extends({anchor:l,ref:R,width:f},T))))});"production"!==process.env.NODE_ENV&&(SwipeableDrawer.propTypes={anchor:PropTypes.oneOf(["left","top","right","bottom"]),children:PropTypes.node,disableBackdropTransition:PropTypes.bool,disableDiscovery:PropTypes.bool,disableSwipeToOpen:PropTypes.bool,hideBackdrop:PropTypes.bool,hysteresis:PropTypes.number,minFlingVelocity:PropTypes.number,ModalProps:PropTypes.shape({BackdropProps:PropTypes.shape({component:elementTypeAcceptingRef})}),onClose:PropTypes.func.isRequired,onOpen:PropTypes.func.isRequired,open:PropTypes.bool.isRequired,PaperProps:PropTypes.shape({component:elementTypeAcceptingRef,style:PropTypes.object}),SwipeAreaProps:PropTypes.object,swipeAreaWidth:PropTypes.number,transitionDuration:PropTypes.oneOfType([PropTypes.number,PropTypes.shape({enter:PropTypes.number,exit:PropTypes.number})]),variant:PropTypes.oneOf(["permanent","persistent","temporary"])});export default SwipeableDrawer;export{reset};