import getScrollbarSize from"../utils/getScrollbarSize";import ownerDocument from"../utils/ownerDocument";import ownerWindow from"../utils/ownerWindow";function isOverflowing(e){var i=ownerDocument(e);return i.body===e?ownerWindow(i).innerWidth>i.documentElement.clientWidth:e.scrollHeight>e.clientHeight}function ariaHidden(e,i){i?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")}function getPaddingRight(e){return parseInt(window.getComputedStyle(e)["padding-right"],10)||0}function ariaHiddenSiblings(e,i,t,n=[],o){const r=[i,t,...n],d=["TEMPLATE","SCRIPT","STYLE"];[].forEach.call(e.children,e=>{1===e.nodeType&&-1===r.indexOf(e)&&-1===d.indexOf(e.tagName)&&ariaHidden(e,o)})}function findIndexOf(e,t){let n=-1;return e.some((e,i)=>!!t(e)&&(n=i,!0)),n}function handleContainer(e,i){const t=[],n=[],o=e.container;let r;if(!i.disableScrollLock){if(isOverflowing(o)){const a=getScrollbarSize();t.push({value:o.style.paddingRight,key:"padding-right",el:o}),o.style["padding-right"]=`${getPaddingRight(o)+a}px`,r=ownerDocument(o).querySelectorAll(".mui-fixed"),[].forEach.call(r,e=>{n.push(e.style.paddingRight),e.style.paddingRight=`${getPaddingRight(e)+a}px`})}i=o.parentElement;const d="HTML"===i.nodeName&&"scroll"===window.getComputedStyle(i)["overflow-y"]?i:o;t.push({value:d.style.overflow,key:"overflow",el:d}),d.style.overflow="hidden"}return()=>{r&&[].forEach.call(r,(e,i)=>{n[i]?e.style.paddingRight=n[i]:e.style.removeProperty("padding-right")}),t.forEach(({value:e,el:i,key:t})=>{e?i.style.setProperty(t,e):i.style.removeProperty(t)})}}function getHiddenSiblings(e){const i=[];return[].forEach.call(e.children,e=>{e.getAttribute&&"true"===e.getAttribute("aria-hidden")&&i.push(e)}),i}export default class ModalManager{constructor(){this.modals=[],this.containers=[]}add(e,i){let t=this.modals.indexOf(e);if(-1!==t)return t;t=this.modals.length,this.modals.push(e),e.modalRef&&ariaHidden(e.modalRef,!1);var n=getHiddenSiblings(i);ariaHiddenSiblings(i,e.mountNode,e.modalRef,n,!0);var o=findIndexOf(this.containers,e=>e.container===i);return-1!==o?this.containers[o].modals.push(e):this.containers.push({modals:[e],container:i,restore:null,hiddenSiblingNodes:n}),t}mount(i,e){var t=findIndexOf(this.containers,e=>-1!==e.modals.indexOf(i));const n=this.containers[t];n.restore||(n.restore=handleContainer(n,e))}remove(i){var e=this.modals.indexOf(i);if(-1===e)return e;var t=findIndexOf(this.containers,e=>-1!==e.modals.indexOf(i));const n=this.containers[t];return n.modals.splice(n.modals.indexOf(i),1),this.modals.splice(e,1),0===n.modals.length?(n.restore&&n.restore(),i.modalRef&&ariaHidden(i.modalRef,!0),ariaHiddenSiblings(n.container,i.mountNode,i.modalRef,n.hiddenSiblingNodes,!1),this.containers.splice(t,1)):(t=n.modals[n.modals.length-1]).modalRef&&ariaHidden(t.modalRef,!1),e}isTopModal(e){return 0<this.modals.length&&this.modals[this.modals.length-1]===e}}export{ariaHidden};