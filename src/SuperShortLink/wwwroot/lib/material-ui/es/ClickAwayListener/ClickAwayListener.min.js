import*as React from"react";import*as ReactDOM from"react-dom";import PropTypes from"prop-types";import ownerDocument from"../utils/ownerDocument";import useForkRef from"../utils/useForkRef";import useEventCallback from"../utils/useEventCallback";import{elementAcceptingRef,exactProp}from"@material-ui/utils";function mapEventPropToEvent(e){return e.substring(2).toLowerCase()}function clickedRootScrollbar(e){return document.documentElement.clientWidth<e.clientX||document.documentElement.clientHeight<e.clientY}function ClickAwayListener(e){const{children:r,disableReactTree:o=!1,mouseEvent:n="onClick",onClickAway:c,touchEvent:u="onTouchEnd"}=e,s=React.useRef(!1),i=React.useRef(null),a=React.useRef(!1),l=React.useRef(!1);React.useEffect(()=>(setTimeout(()=>{a.current=!0},0),()=>{a.current=!1}),[]);var t=React.useCallback(e=>{i.current=ReactDOM.findDOMNode(e)},[]),e=useForkRef(r.ref,t);const p=useEventCallback(t=>{var n=l.current;if(l.current=!1,a.current&&i.current&&!clickedRootScrollbar(t))if(s.current)s.current=!1;else{let e;if(t.composedPath)e=-1<t.composedPath().indexOf(i.current);else{const r=ownerDocument(i.current);e=!r.documentElement.contains(t.target)||i.current.contains(t.target)}e||!o&&n||c(t)}});t=n=>e=>{l.current=!0;const t=r.props[n];t&&t(e)};const m={ref:e};return!1!==u&&(m[u]=t(u)),React.useEffect(()=>{if(!1!==u){const e=mapEventPropToEvent(u),t=ownerDocument(i.current),n=()=>{s.current=!0};return t.addEventListener(e,p),t.addEventListener("touchmove",n),()=>{t.removeEventListener(e,p),t.removeEventListener("touchmove",n)}}},[p,u]),!1!==n&&(m[n]=t(n)),React.useEffect(()=>{if(!1!==n){const e=mapEventPropToEvent(n),t=ownerDocument(i.current);return t.addEventListener(e,p),()=>{t.removeEventListener(e,p)}}},[p,n]),React.createElement(React.Fragment,null,React.cloneElement(r,m))}"production"!==process.env.NODE_ENV&&(ClickAwayListener.propTypes={children:elementAcceptingRef.isRequired,disableReactTree:PropTypes.bool,mouseEvent:PropTypes.oneOf(["onClick","onMouseDown","onMouseUp",!1]),onClickAway:PropTypes.func.isRequired,touchEvent:PropTypes.oneOf(["onTouchEnd","onTouchStart",!1])}),"production"!==process.env.NODE_ENV&&(ClickAwayListener.propTypes=exactProp(ClickAwayListener.propTypes));export default ClickAwayListener;