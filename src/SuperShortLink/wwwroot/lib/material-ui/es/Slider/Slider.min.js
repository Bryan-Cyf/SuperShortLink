import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import PropTypes from"prop-types";import clsx from"clsx";import{chainPropTypes}from"@material-ui/utils";import withStyles from"../styles/withStyles";import useTheme from"../styles/useTheme";import{alpha,lighten,darken}from"../styles/colorManipulator";import useIsFocusVisible from"../utils/useIsFocusVisible";import ownerDocument from"../utils/ownerDocument";import useEventCallback from"../utils/useEventCallback";import useForkRef from"../utils/useForkRef";import capitalize from"../utils/capitalize";import useControlled from"../utils/useControlled";import ValueLabel from"./ValueLabel";function asc(e,t){return e-t}function clamp(e,t,a){return Math.min(Math.max(t,e),a)}function findClosest(e,r){var e=e.reduce((e,t,a)=>{t=Math.abs(r-t);return null===e||t<e.distance||t===e.distance?{distance:t,index:a}:e},null)["index"];return e}function trackFinger(t,a){if(void 0!==a.current&&t.changedTouches){for(let e=0;e<t.changedTouches.length;e+=1){var r=t.changedTouches[e];if(r.identifier===a.current)return{x:r.clientX,y:r.clientY}}return!1}return{x:t.clientX,y:t.clientY}}function valueToPercent(e,t,a){return 100*(e-t)/(a-t)}function percentToValue(e,t,a){return(a-t)*e+t}function getDecimalPrecision(e){if(Math.abs(e)<1){const a=e.toExponential().split("e-");var t=a[0].split(".")[1];return(t?t.length:0)+parseInt(a[1],10)}e=e.toString().split(".")[1];return e?e.length:0}function roundValueToStep(e,t,a){const r=Math.round((e-a)/t)*t+a;return Number(r.toFixed(getDecimalPrecision(t)))}function setValueIndex({values:e,source:t,newValue:a,index:r}){if(e[r]===a)return t;const o=e.slice();return o[r]=a,o}function focusThumb({sliderRef:e,activeIndex:t,setActive:a}){e.current.contains(document.activeElement)&&Number(document.activeElement.getAttribute("data-index"))===t||e.current.querySelector(`[role="slider"][data-index="${t}"]`).focus(),a&&a(t)}const axisProps={horizontal:{offset:e=>({left:`${e}%`}),leap:e=>({width:`${e}%`})},"horizontal-reverse":{offset:e=>({right:`${e}%`}),leap:e=>({width:`${e}%`})},vertical:{offset:e=>({bottom:`${e}%`}),leap:e=>({height:`${e}%`})}},Identity=e=>e,styles=e=>({root:{height:2,width:"100%",boxSizing:"content-box",padding:"13px 0",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",color:e.palette.primary.main,WebkitTapHighlightColor:"transparent","&$disabled":{pointerEvents:"none",cursor:"default",color:e.palette.grey[400]},"&$vertical":{width:2,height:"100%",padding:"0 13px"},"@media (pointer: coarse)":{padding:"20px 0","&$vertical":{padding:"0 20px"}},"@media print":{colorAdjust:"exact"}},colorPrimary:{},colorSecondary:{color:e.palette.secondary.main},marked:{marginBottom:20,"&$vertical":{marginBottom:"auto",marginRight:20}},vertical:{},disabled:{},rail:{display:"block",position:"absolute",width:"100%",height:2,borderRadius:1,backgroundColor:"currentColor",opacity:.38,"$vertical &":{height:"100%",width:2}},track:{display:"block",position:"absolute",height:2,borderRadius:1,backgroundColor:"currentColor","$vertical &":{width:2}},trackFalse:{"& $track":{display:"none"}},trackInverted:{"& $track":{backgroundColor:"light"===e.palette.type?lighten(e.palette.primary.main,.62):darken(e.palette.primary.main,.5)},"& $rail":{opacity:1}},thumb:{position:"absolute",width:12,height:12,marginLeft:-6,marginTop:-5,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow"],{duration:e.transitions.duration.shortest}),"&::after":{position:"absolute",content:'""',borderRadius:"50%",left:-15,top:-15,right:-15,bottom:-15},"&$focusVisible,&:hover":{boxShadow:`0px 0px 0px 8px ${alpha(e.palette.primary.main,.16)}`,"@media (hover: none)":{boxShadow:"none"}},"&$active":{boxShadow:`0px 0px 0px 14px ${alpha(e.palette.primary.main,.16)}`},"&$disabled":{width:8,height:8,marginLeft:-4,marginTop:-3,"&:hover":{boxShadow:"none"}},"$vertical &":{marginLeft:-5,marginBottom:-6},"$vertical &$disabled":{marginLeft:-3,marginBottom:-4}},thumbColorPrimary:{},thumbColorSecondary:{"&$focusVisible,&:hover":{boxShadow:`0px 0px 0px 8px ${alpha(e.palette.secondary.main,.16)}`},"&$active":{boxShadow:`0px 0px 0px 14px ${alpha(e.palette.secondary.main,.16)}`}},active:{},focusVisible:{},valueLabel:{left:"calc(-50% - 4px)"},mark:{position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor"},markActive:{backgroundColor:e.palette.background.paper,opacity:.8},markLabel:_extends({},e.typography.body2,{color:e.palette.text.secondary,position:"absolute",top:26,transform:"translateX(-50%)",whiteSpace:"nowrap","$vertical &":{top:"auto",left:26,transform:"translateY(50%)"},"@media (pointer: coarse)":{top:40,"$vertical &":{left:31}}}),markLabelActive:{color:e.palette.text.primary}}),Slider=React.forwardRef(function(e,t){const{"aria-label":r,"aria-labelledby":o,"aria-valuetext":n,classes:l,className:a,color:i="primary",component:s="span",defaultValue:u,disabled:c=!1,getAriaLabel:p,getAriaValueText:m,marks:d=!1,max:v=100,min:b=0,name:f,onChange:h,onChangeCommitted:y,onMouseDown:g,orientation:x="horizontal",scale:T=Identity,step:k=1,ThumbComponent:P="span",track:w="normal",value:C,ValueLabelComponent:L=ValueLabel,valueLabelDisplay:E="off",valueLabelFormat:R=Identity}=e,V=_objectWithoutPropertiesLoose(e,["aria-label","aria-labelledby","aria-valuetext","classes","className","color","component","defaultValue","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","onMouseDown","orientation","scale","step","ThumbComponent","track","value","ValueLabelComponent","valueLabelDisplay","valueLabelFormat"]);var A=useTheme();const $=React.useRef(),[S,I]=React.useState(-1),[D,F]=React.useState(-1),[O,N]=useControlled({controlled:C,default:u,name:"Slider"}),M=Array.isArray(O);let z=M?O.slice().sort(asc):[O];z=z.map(e=>clamp(e,b,v));const j=!0===d&&null!==k?[...Array(Math.floor((v-b)/k)+1)].map((e,t)=>({value:b+k*t})):d||[],{isFocusVisible:B,onBlurVisible:_,ref:Y}=useIsFocusVisible(),[U,W]=React.useState(-1),X=React.useRef();var q=useForkRef(Y,X),e=useForkRef(t,q);const H=useEventCallback(e=>{var t=Number(e.currentTarget.getAttribute("data-index"));B(e)&&W(t),F(t)}),K=useEventCallback(()=>{-1!==U&&(W(-1),_()),F(-1)}),G=useEventCallback(e=>{e=Number(e.currentTarget.getAttribute("data-index"));F(e)}),J=useEventCallback(()=>{F(-1)}),Q="rtl"===A.direction,Z=useEventCallback(e=>{var t=Number(e.currentTarget.getAttribute("data-index")),a=z[t],r=(v-b)/10;const o=j.map(e=>e.value);var n=o.indexOf(a);let l;var i=Q?"ArrowLeft":"ArrowRight",s=Q?"ArrowRight":"ArrowLeft";switch(e.key){case"Home":l=b;break;case"End":l=v;break;case"PageUp":k&&(l=a+r);break;case"PageDown":k&&(l=a-r);break;case i:case"ArrowUp":l=k?a+k:o[n+1]||o[o.length-1];break;case s:case"ArrowDown":l=k?a-k:o[n-1]||o[0];break;default:return}e.preventDefault(),k&&(l=roundValueToStep(l,k,b)),l=clamp(l,b,v),M&&(s=l,l=setValueIndex({values:z,source:O,newValue:l,index:t}).sort(asc),focusThumb({sliderRef:X,activeIndex:l.indexOf(s)})),N(l),W(t),h&&h(e,l),y&&y(e,l)}),ee=React.useRef();let te=x;Q&&"vertical"!==x&&(te+="-reverse");const ae=({finger:e,move:t=!1,values:a,source:r})=>{const o=X["current"];var{width:n,height:l,bottom:i,left:s}=o.getBoundingClientRect();let u;u=0===te.indexOf("vertical")?(i-e.y)/l:(e.x-s)/n,-1!==te.indexOf("-reverse")&&(u=1-u);let c;c=percentToValue(u,b,v),c=k?roundValueToStep(c,k,b):(n=findClosest(s=j.map(e=>e.value),c),s[n]),c=clamp(c,b,v);let p=0;return M&&(p=t?ee.current:findClosest(a,c),t=c,c=setValueIndex({values:a,source:r,newValue:c,index:p}).sort(asc),p=c.indexOf(t),ee.current=p),{newValue:c,activeIndex:p}},re=useEventCallback(e=>{var t,a=trackFinger(e,$);a&&({newValue:t,activeIndex:a}=ae({finger:a,move:!0,values:z,source:O}),focusThumb({sliderRef:X,activeIndex:a,setActive:I}),N(t),h&&h(e,t))}),oe=useEventCallback(e=>{var t=trackFinger(e,$);if(t){var t=ae({finger:t,values:z,source:O})["newValue"];I(-1),"touchend"===e.type&&F(-1),y&&y(e,t),$.current=void 0;const a=ownerDocument(X.current);a.removeEventListener("mousemove",re),a.removeEventListener("mouseup",oe),a.removeEventListener("touchmove",re),a.removeEventListener("touchend",oe)}}),ne=useEventCallback(e=>{e.preventDefault();var t=e.changedTouches[0];null!=t&&($.current=t.identifier);var a=trackFinger(e,$),{newValue:t,activeIndex:a}=ae({finger:a,values:z,source:O});focusThumb({sliderRef:X,activeIndex:a,setActive:I}),N(t),h&&h(e,t);const r=ownerDocument(X.current);r.addEventListener("touchmove",re),r.addEventListener("touchend",oe)});React.useEffect(()=>{const e=X["current"];e.addEventListener("touchstart",ne);const t=ownerDocument(e);return()=>{e.removeEventListener("touchstart",ne),t.removeEventListener("mousemove",re),t.removeEventListener("mouseup",oe),t.removeEventListener("touchmove",re),t.removeEventListener("touchend",oe)}},[oe,re,ne]);t=useEventCallback(e=>{g&&g(e),e.preventDefault();var t=trackFinger(e,$),{newValue:a,activeIndex:t}=ae({finger:t,values:z,source:O});focusThumb({sliderRef:X,activeIndex:t,setActive:I}),N(a),h&&h(e,a);const r=ownerDocument(X.current);r.addEventListener("mousemove",re),r.addEventListener("mouseup",oe)}),q=valueToPercent(M?z[0]:b,b,v),A=valueToPercent(z[z.length-1],b,v)-q,A=_extends({},axisProps[te].offset(q),axisProps[te].leap(A));return React.createElement(s,_extends({ref:e,className:clsx(l.root,l[`color${capitalize(i)}`],a,c&&l.disabled,0<j.length&&j.some(e=>e.label)&&l.marked,!1===w&&l.trackFalse,"vertical"===x&&l.vertical,"inverted"===w&&l.trackInverted),onMouseDown:t},V),React.createElement("span",{className:l.rail}),React.createElement("span",{className:l.track,style:A}),React.createElement("input",{value:z.join(","),name:f,type:"hidden"}),j.map((e,t)=>{var a=valueToPercent(e.value,b,v),a=axisProps[te].offset(a);let r;return r=!1===w?-1!==z.indexOf(e.value):"normal"===w&&(M?e.value>=z[0]&&e.value<=z[z.length-1]:e.value<=z[0])||"inverted"===w&&(M?e.value<=z[0]||e.value>=z[z.length-1]:e.value>=z[0]),React.createElement(React.Fragment,{key:e.value},React.createElement("span",{style:a,"data-index":t,className:clsx(l.mark,r&&l.markActive)}),null!=e.label?React.createElement("span",{"aria-hidden":!0,"data-index":t,style:a,className:clsx(l.markLabel,r&&l.markLabelActive)},e.label):null)}),z.map((e,t)=>{var a=valueToPercent(e,b,v),a=axisProps[te].offset(a);return React.createElement(L,{key:t,valueLabelFormat:R,valueLabelDisplay:E,className:l.valueLabel,value:"function"==typeof R?R(T(e),t):R,index:t,open:D===t||S===t||"on"===E,disabled:c},React.createElement(P,{className:clsx(l.thumb,l[`thumbColor${capitalize(i)}`],S===t&&l.active,c&&l.disabled,U===t&&l.focusVisible),tabIndex:c?null:0,role:"slider",style:a,"data-index":t,"aria-label":p?p(t):r,"aria-labelledby":o,"aria-orientation":x,"aria-valuemax":T(v),"aria-valuemin":T(b),"aria-valuenow":T(e),"aria-valuetext":m?m(T(e),t):n,onKeyDown:Z,onFocus:H,onBlur:K,onMouseOver:G,onMouseLeave:J}))}))});"production"!==process.env.NODE_ENV&&(Slider.propTypes={"aria-label":chainPropTypes(PropTypes.string,e=>{return Array.isArray(e.value||e.defaultValue)&&null!=e["aria-label"]?new Error("Material-UI: You need to use the `getAriaLabel` prop instead of `aria-label` when using a range slider."):null}),"aria-labelledby":PropTypes.string,"aria-valuetext":chainPropTypes(PropTypes.string,e=>{return Array.isArray(e.value||e.defaultValue)&&null!=e["aria-valuetext"]?new Error("Material-UI: You need to use the `getAriaValueText` prop instead of `aria-valuetext` when using a range slider."):null}),classes:PropTypes.object.isRequired,className:PropTypes.string,color:PropTypes.oneOf(["primary","secondary"]),component:PropTypes.elementType,defaultValue:PropTypes.oneOfType([PropTypes.number,PropTypes.arrayOf(PropTypes.number)]),disabled:PropTypes.bool,getAriaLabel:PropTypes.func,getAriaValueText:PropTypes.func,marks:PropTypes.oneOfType([PropTypes.bool,PropTypes.array]),max:PropTypes.number,min:PropTypes.number,name:PropTypes.string,onChange:PropTypes.func,onChangeCommitted:PropTypes.func,onMouseDown:PropTypes.func,orientation:PropTypes.oneOf(["horizontal","vertical"]),scale:PropTypes.func,step:PropTypes.number,ThumbComponent:PropTypes.elementType,track:PropTypes.oneOf(["normal",!1,"inverted"]),value:PropTypes.oneOfType([PropTypes.number,PropTypes.arrayOf(PropTypes.number)]),ValueLabelComponent:PropTypes.elementType,valueLabelDisplay:PropTypes.oneOf(["on","auto","off"]),valueLabelFormat:PropTypes.oneOfType([PropTypes.string,PropTypes.func])});export default withStyles(styles,{name:"MuiSlider"})(Slider);export{styles};