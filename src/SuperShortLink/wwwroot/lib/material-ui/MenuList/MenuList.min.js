"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_reactIs=require("react-is"),_propTypes=_interopRequireDefault(require("prop-types")),ReactDOM=_interopRequireWildcard(require("react-dom")),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_List=_interopRequireDefault(require("../List")),_getScrollbarSize=_interopRequireDefault(require("../utils/getScrollbarSize")),_useForkRef=_interopRequireDefault(require("../utils/useForkRef"));function nextItem(e,t,r){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:r?null:e.firstChild}function previousItem(e,t,r){return e===t?r?e.firstChild:e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:r?null:e.lastChild}function textCriteriaMatches(e,t){if(void 0===t)return!0;var r=e.innerText;return 0!==(r=(r=void 0===r?e.textContent:r).trim().toLowerCase()).length&&(t.repeating?r[0]===t.keys[0]:0===r.indexOf(t.keys.join("")))}function moveFocus(e,t,r,i,n,o){for(var a=!1,u=n(e,t,!!t&&r);u;){if(u===e.firstChild){if(a)return;a=!0}var s=!i&&(u.disabled||"true"===u.getAttribute("aria-disabled"));if(u.hasAttribute("tabindex")&&textCriteriaMatches(u,o)&&!s)return void u.focus();u=n(e,u,r)}}var useEnhancedEffect="undefined"==typeof window?React.useEffect:React.useLayoutEffect,MenuList=React.forwardRef(function(e,t){var r=e.actions,i=e.autoFocus,n=void 0!==i&&i,o=e.autoFocusItem,a=void 0!==o&&o,u=e.children,i=e.className,o=e.disabledItemsFocusable,s=void 0!==o&&o,o=e.disableListWrap,l=void 0!==o&&o,c=e.onKeyDown,o=e.variant,d=void 0===o?"selectedMenu":o,e=(0,_objectWithoutProperties2.default)(e,["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"]),p=React.useRef(null),f=React.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});useEnhancedEffect(function(){n&&p.current.focus()},[n]),React.useImperativeHandle(r,function(){return{adjustStyleForScrollbar:function(e,t){var r=!p.current.style.width;return e.clientHeight<p.current.clientHeight&&r&&(r="".concat((0,_getScrollbarSize.default)(!0),"px"),p.current.style["rtl"===t.direction?"paddingLeft":"paddingRight"]=r,p.current.style.width="calc(100% + ".concat(r,")")),p.current}}},[]);var r=React.useCallback(function(e){p.current=ReactDOM.findDOMNode(e)},[]),t=(0,_useForkRef.default)(r,t),m=-1;React.Children.forEach(u,function(e,t){React.isValidElement(e)&&("production"!==process.env.NODE_ENV&&(0,_reactIs.isFragment)(e)&&console.error(["Material-UI: The Menu component doesn't accept a Fragment as a child.","Consider providing an array instead."].join("\n")),e.props.disabled||("selectedMenu"===d&&e.props.selected||-1===m)&&(m=t))});u=React.Children.map(u,function(e,t){if(t!==m)return e;t={};return a&&(t.autoFocus=!0),void 0===e.props.tabIndex&&"selectedMenu"===d&&(t.tabIndex=0),React.cloneElement(e,t)});return React.createElement(_List.default,(0,_extends2.default)({role:"menu",ref:t,className:i,onKeyDown:function(e){var t,r,i=p.current,n=e.key,o=(0,_ownerDocument.default)(i).activeElement;"ArrowDown"===n?(e.preventDefault(),moveFocus(i,o,l,s,nextItem)):"ArrowUp"===n?(e.preventDefault(),moveFocus(i,o,l,s,previousItem)):"Home"===n?(e.preventDefault(),moveFocus(i,null,l,s,nextItem)):"End"===n?(e.preventDefault(),moveFocus(i,null,l,s,previousItem)):1===n.length&&(t=f.current,r=n.toLowerCase(),n=performance.now(),0<t.keys.length&&(500<n-t.lastTime?(t.keys=[],t.repeating=!0,t.previousKeyMatched=!0):t.repeating&&r!==t.keys[0]&&(t.repeating=!1)),t.lastTime=n,t.keys.push(r),r=o&&!t.repeating&&textCriteriaMatches(o,t),t.previousKeyMatched&&(r||moveFocus(i,o,!1,s,nextItem,t))?e.preventDefault():t.previousKeyMatched=!1),c&&c(e)},tabIndex:n?0:-1},e),u)});"production"!==process.env.NODE_ENV&&(MenuList.propTypes={autoFocus:_propTypes.default.bool,autoFocusItem:_propTypes.default.bool,children:_propTypes.default.node,className:_propTypes.default.string,disabledItemsFocusable:_propTypes.default.bool,disableListWrap:_propTypes.default.bool,onKeyDown:_propTypes.default.func,variant:_propTypes.default.oneOf(["menu","selectedMenu"])});var _default=MenuList;exports.default=_default;