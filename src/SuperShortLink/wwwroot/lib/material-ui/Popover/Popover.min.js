"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.getOffsetTop=getOffsetTop,exports.getOffsetLeft=getOffsetLeft,exports.default=exports.styles=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),React=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),ReactDOM=_interopRequireWildcard(require("react-dom")),_utils=require("@material-ui/utils"),_debounce=_interopRequireDefault(require("../utils/debounce")),_clsx=_interopRequireDefault(require("clsx")),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_ownerWindow=_interopRequireDefault(require("../utils/ownerWindow")),_createChainedFunction=_interopRequireDefault(require("../utils/createChainedFunction")),_deprecatedPropType=_interopRequireDefault(require("../utils/deprecatedPropType")),_withStyles=_interopRequireDefault(require("../styles/withStyles")),_Modal=_interopRequireDefault(require("../Modal")),_Grow=_interopRequireDefault(require("../Grow")),_Paper=_interopRequireDefault(require("../Paper"));function getOffsetTop(e,t){var o=0;return"number"==typeof t?o=t:"center"===t?o=e.height/2:"bottom"===t&&(o=e.height),o}function getOffsetLeft(e,t){var o=0;return"number"==typeof t?o=t:"center"===t?o=e.width/2:"right"===t&&(o=e.width),o}function getTransformOriginValue(e){return[e.horizontal,e.vertical].map(function(e){return"number"==typeof e?"".concat(e,"px"):e}).join(" ")}function getScrollParent(e,t){for(var o=t,r=0;o&&o!==e;)r+=(o=o.parentElement).scrollTop;return r}function getAnchorEl(e){return"function"==typeof e?e():e}var styles={root:{},paper:{position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}};exports.styles=styles;var Popover=React.forwardRef(function(e,t){var o=e.action,u=e.anchorEl,r=e.anchorOrigin,n=void 0===r?{vertical:"top",horizontal:"left"}:r,i=e.anchorPosition,a=e.anchorReference,s=void 0===a?"anchorEl":a,p=e.children,l=e.classes,c=e.className,f=e.container,d=e.elevation,h=void 0===d?8:d,_=e.getContentAnchorEl,T=e.marginThreshold,y=void 0===T?16:T,m=e.onEnter,g=e.onEntered,v=e.onEntering,E=e.onExit,R=e.onExited,b=e.onExiting,O=e.open,P=e.PaperProps,r=void 0===P?{}:P,a=e.transformOrigin,q=void 0===a?{vertical:"top",horizontal:"left"}:a,d=e.TransitionComponent,T=void 0===d?_Grow.default:d,P=e.transitionDuration,a=void 0===P?"auto":P,d=e.TransitionProps,P=void 0===d?{}:d,d=(0,_objectWithoutProperties2.default)(e,["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","classes","className","container","elevation","getContentAnchorEl","marginThreshold","onEnter","onEntered","onEntering","onExit","onExited","onExiting","open","PaperProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"]),x=React.useRef(),w=React.useCallback(function(e){if("anchorPosition"===s)return"production"!==process.env.NODE_ENV&&(i||console.error('Material-UI: You need to provide a `anchorPosition` prop when using <Popover anchorReference="anchorPosition" />.')),i;var t=getAnchorEl(u),o=t&&1===t.nodeType?t:(0,_ownerDocument.default)(x.current).body,t=o.getBoundingClientRect();"production"!==process.env.NODE_ENV&&(o=o.getBoundingClientRect(),"test"!==process.env.NODE_ENV&&0===o.top&&0===o.left&&0===o.right&&0===o.bottom&&console.warn(["Material-UI: The `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n")));e=0===e?n.vertical:"center";return{top:t.top+getOffsetTop(t,e),left:t.left+getOffsetLeft(t,n.horizontal)}},[u,n.horizontal,n.vertical,i,s]),D=React.useCallback(function(e){var t,o=0;return _&&"anchorEl"===s&&((t=_(e))&&e.contains(t)&&(e=getScrollParent(e,t),o=t.offsetTop+t.clientHeight/2-e||0),"production"!==process.env.NODE_ENV&&"top"!==n.vertical&&console.error(["Material-UI: You can not change the default `anchorOrigin.vertical` value ","when also providing the `getContentAnchorEl` prop to the popover component.","Only use one of the two props.","Set `getContentAnchorEl` to `null | undefined` or leave `anchorOrigin.vertical` unchanged."].join("\n"))),o},[n.vertical,s,_]),C=React.useCallback(function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return{vertical:getOffsetTop(e,q.vertical)+t,horizontal:getOffsetLeft(e,q.horizontal)}},[q.horizontal,q.vertical]),N=React.useCallback(function(e){var t=D(e),o={width:e.offsetWidth,height:e.offsetHeight},r=C(o,t);if("none"===s)return{top:null,left:null,transformOrigin:getTransformOriginValue(r)};var n=w(t),i=n.top-r.vertical,a=n.left-r.horizontal,p=i+o.height,l=a+o.width,e=(0,_ownerWindow.default)(getAnchorEl(u)),t=e.innerHeight-y,n=e.innerWidth-y;return i<y?(i-=e=i-y,r.vertical+=e):t<p&&(i-=p=p-t,r.vertical+=p),"production"!==process.env.NODE_ENV&&t<o.height&&o.height&&t&&console.error(["Material-UI: The popover component is too tall.","Some part of it can not be seen on the screen (".concat(o.height-t,"px)."),"Please consider adding a `max-height` to improve the user-experience."].join("\n")),a<y?(a-=t=a-y,r.horizontal+=t):n<l&&(a-=n=l-n,r.horizontal+=n),{top:"".concat(Math.round(i),"px"),left:"".concat(Math.round(a),"px"),transformOrigin:getTransformOriginValue(r)}},[u,s,w,D,C,y]),M=React.useCallback(function(){var e,t=x.current;t&&(null!==(e=N(t)).top&&(t.style.top=e.top),null!==e.left&&(t.style.left=e.left),t.style.transformOrigin=e.transformOrigin)},[N]),e=React.useCallback(function(e){x.current=ReactDOM.findDOMNode(e)},[]);React.useEffect(function(){O&&M()}),React.useImperativeHandle(o,function(){return O?{updatePosition:function(){M()}}:null},[O,M]),React.useEffect(function(){if(O){var e=(0,_debounce.default)(function(){M()});return window.addEventListener("resize",e),function(){e.clear(),window.removeEventListener("resize",e)}}},[O,M]);o=a;"auto"!==a||T.muiSupportAuto||(o=void 0);f=f||(u?(0,_ownerDocument.default)(getAnchorEl(u)).body:void 0);return React.createElement(_Modal.default,(0,_extends2.default)({container:f,open:O,ref:t,BackdropProps:{invisible:!0},className:(0,_clsx.default)(l.root,c)},d),React.createElement(T,(0,_extends2.default)({appear:!0,in:O,onEnter:m,onEntered:g,onExit:E,onExited:R,onExiting:b,timeout:o},P,{onEntering:(0,_createChainedFunction.default)(function(e,t){v&&v(e,t),M()},P.onEntering)}),React.createElement(_Paper.default,(0,_extends2.default)({elevation:h,ref:e},r,{className:(0,_clsx.default)(l.paper,r.className)}),p)))});"production"!==process.env.NODE_ENV&&(Popover.propTypes={action:_utils.refType,anchorEl:(0,_utils.chainPropTypes)(_propTypes.default.oneOfType([_utils.HTMLElementType,_propTypes.default.func]),function(e){if(e.open&&(!e.anchorReference||"anchorEl"===e.anchorReference)){e=getAnchorEl(e.anchorEl);if(!e||1!==e.nodeType)return new Error(["Material-UI: The `anchorEl` prop provided to the component is invalid.","It should be an Element instance but it's `".concat(e,"` instead.")].join("\n"));e=e.getBoundingClientRect();if("test"!==process.env.NODE_ENV&&0===e.top&&0===e.left&&0===e.right&&0===e.bottom)return new Error(["Material-UI: The `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}return null}),anchorOrigin:_propTypes.default.shape({horizontal:_propTypes.default.oneOfType([_propTypes.default.oneOf(["center","left","right"]),_propTypes.default.number]).isRequired,vertical:_propTypes.default.oneOfType([_propTypes.default.oneOf(["bottom","center","top"]),_propTypes.default.number]).isRequired}),anchorPosition:_propTypes.default.shape({left:_propTypes.default.number.isRequired,top:_propTypes.default.number.isRequired}),anchorReference:_propTypes.default.oneOf(["anchorEl","anchorPosition","none"]),children:_propTypes.default.node,classes:_propTypes.default.object,className:_propTypes.default.string,container:_propTypes.default.oneOfType([_utils.HTMLElementType,_propTypes.default.instanceOf(React.Component),_propTypes.default.func]),elevation:_propTypes.default.number,getContentAnchorEl:_propTypes.default.func,marginThreshold:_propTypes.default.number,onClose:_propTypes.default.func,onEnter:(0,_deprecatedPropType.default)(_propTypes.default.func,"Use the `TransitionProps` prop instead."),onEntered:(0,_deprecatedPropType.default)(_propTypes.default.func,"Use the `TransitionProps` prop instead."),onEntering:(0,_deprecatedPropType.default)(_propTypes.default.func,"Use the `TransitionProps` prop instead."),onExit:(0,_deprecatedPropType.default)(_propTypes.default.func,"Use the `TransitionProps` prop instead."),onExited:(0,_deprecatedPropType.default)(_propTypes.default.func,"Use the `TransitionProps` prop instead."),onExiting:(0,_deprecatedPropType.default)(_propTypes.default.func,"Use the `TransitionProps` prop instead."),open:_propTypes.default.bool.isRequired,PaperProps:_propTypes.default.shape({component:_utils.elementTypeAcceptingRef}),transformOrigin:_propTypes.default.shape({horizontal:_propTypes.default.oneOfType([_propTypes.default.oneOf(["center","left","right"]),_propTypes.default.number]).isRequired,vertical:_propTypes.default.oneOfType([_propTypes.default.oneOf(["bottom","center","top"]),_propTypes.default.number]).isRequired}),TransitionComponent:_propTypes.default.elementType,transitionDuration:_propTypes.default.oneOfType([_propTypes.default.oneOf(["auto"]),_propTypes.default.number,_propTypes.default.shape({appear:_propTypes.default.number,enter:_propTypes.default.number,exit:_propTypes.default.number})]),TransitionProps:_propTypes.default.object});var _default=(0,_withStyles.default)(styles,{name:"MuiPopover"})(Popover);exports.default=_default;