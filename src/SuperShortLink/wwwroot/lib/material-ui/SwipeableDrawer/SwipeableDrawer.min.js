"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.reset=reset,exports.default=void 0;var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),React=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),ReactDOM=_interopRequireWildcard(require("react-dom")),_utils=require("@material-ui/utils"),_styles=require("@material-ui/styles"),_Drawer=_interopRequireWildcard(require("../Drawer/Drawer")),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_useEventCallback=_interopRequireDefault(require("../utils/useEventCallback")),_transitions=require("../styles/transitions"),_useTheme=_interopRequireDefault(require("../styles/useTheme")),_utils2=require("../transitions/utils"),_NoSsr=_interopRequireDefault(require("../NoSsr")),_SwipeArea=_interopRequireDefault(require("./SwipeArea")),UNCERTAINTY_THRESHOLD=3,nodeThatClaimedTheSwipe=null;function reset(){nodeThatClaimedTheSwipe=null}function calculateCurrentX(e,t){return"right"===e?document.body.offsetWidth-t[0].pageX:t[0].pageX}function calculateCurrentY(e,t){return"bottom"===e?window.innerHeight-t[0].clientY:t[0].clientY}function getMaxTranslate(e,t){return e?t.clientWidth:t.clientHeight}function getTranslate(e,t,r,n){return Math.min(Math.max(r?t-e:n+t-e,0),n)}function getDomTreeShapes(e,t){for(var r=[];e&&e!==t;){var n=window.getComputedStyle(e);"absolute"===n.getPropertyValue("position")||"hidden"===n.getPropertyValue("overflow-x")?r=[]:(0<e.clientWidth&&e.scrollWidth>e.clientWidth||0<e.clientHeight&&e.scrollHeight>e.clientHeight)&&r.push(e),e=e.parentElement}return r}function findNativeHandler(e){var t=e.domTreeShapes,a=e.start,i=e.current,o=e.anchor,u={x:"scrollLeft",y:"scrollTop"},l={x:"scrollWidth",y:"scrollHeight"},s={x:"clientWidth",y:"clientHeight"};return t.some(function(e){var t=a<=i,r="left"===o||"right"===o?"x":"y",n=e[u[r]],r=n+e[s[r]]<e[l[r]];return(t="top"===o||"left"===o?!t:t)&&r||!t&&0<n?e:null})}var iOS="undefined"!=typeof navigator&&/iPad|iPhone|iPod/.test(navigator.userAgent),transitionDurationDefault={enter:_transitions.duration.enteringScreen,exit:_transitions.duration.leavingScreen},useEnhancedEffect="undefined"!=typeof window?React.useLayoutEffect:React.useEffect,SwipeableDrawer=React.forwardRef(function(e,t){var u=(0,_useTheme.default)(),r=(0,_styles.getThemeProps)({name:"MuiSwipeableDrawer",props:(0,_extends2.default)({},e),theme:u}),n=r.anchor,l=void 0===n?"left":n,a=r.disableBackdropTransition,o=void 0!==a&&a,i=r.disableDiscovery,s=void 0!==i&&i,c=r.disableSwipeToOpen,p=void 0===c?iOS:c,d=r.hideBackdrop,f=r.hysteresis,h=void 0===f?.52:f,e=r.minFlingVelocity,T=void 0===e?450:e,n=r.ModalProps,a=(n=void 0===n?{}:n).BackdropProps,i=(0,_objectWithoutProperties2.default)(n,["BackdropProps"]),_=r.onClose,m=r.onOpen,v=r.open,c=r.PaperProps,f=void 0===c?{}:c,e=r.SwipeAreaProps,n=r.swipeAreaWidth,y=void 0===n?20:n,c=r.transitionDuration,w=void 0===c?transitionDurationDefault:c,n=r.variant,b=void 0===n?"temporary":n,c=(0,_objectWithoutProperties2.default)(r,["anchor","disableBackdropTransition","disableDiscovery","disableSwipeToOpen","hideBackdrop","hysteresis","minFlingVelocity","ModalProps","onClose","onOpen","open","PaperProps","SwipeAreaProps","swipeAreaWidth","transitionDuration","variant"]),n=React.useState(!1),r=n[0],g=n[1],R=React.useRef({isSwiping:null}),D=React.useRef(),S=React.useRef(),E=React.useRef(),C=React.useRef(!1),q=React.useRef();useEnhancedEffect(function(){q.current=null},[v]);var P=React.useCallback(function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.mode,n=void 0===r?null:r,a=t.changeTransition,i=void 0===a||a,r=(0,_Drawer.getAnchor)(u,l),t=-1!==["right","bottom"].indexOf(r)?1:-1,a=(0,_Drawer.isHorizontal)(l),r=a?"translate(".concat(t*e,"px, 0)"):"translate(0, ".concat(t*e,"px)"),t=E.current.style;t.webkitTransform=r,t.transform=r;r="";n&&(r=u.transitions.create("all",(0,_utils2.getTransitionProps)({timeout:w},{mode:n}))),i&&(t.webkitTransition=r,t.transition=r),o||d||((t=S.current.style).opacity=1-e/getMaxTranslate(a,E.current),i&&(t.webkitTransition=r,t.transition=r))},[l,o,d,u,w]),x=(0,_useEventCallback.default)(function(e){var t,r,n;C.current&&(nodeThatClaimedTheSwipe=null,C.current=!1,g(!1),R.current.isSwiping?(n=(R.current.isSwiping=null,_Drawer.getAnchor)(u,l),r=((t=(0,_Drawer.isHorizontal)(l))?calculateCurrentX:calculateCurrentY)(n,e.changedTouches),n=t?R.current.startX:R.current.startY,e=getMaxTranslate(t,E.current),n=(r=getTranslate(r,n,v,e))/e,Math.abs(R.current.velocity)>T&&(q.current=1e3*Math.abs((e-r)/R.current.velocity)),v?R.current.velocity>T||h<n?_():P(0,{mode:"exit"}):R.current.velocity<-T||h<1-n?m():P(getMaxTranslate(t,E.current),{mode:"enter"})):R.current.isSwiping=null)}),H=(0,_useEventCallback.default)(function(e){if(E.current&&C.current&&(null==nodeThatClaimedTheSwipe||nodeThatClaimedTheSwipe===R.current)){var t=(0,_Drawer.getAnchor)(u,l),r=(0,_Drawer.isHorizontal)(l),n=calculateCurrentX(t,e.touches),t=calculateCurrentY(t,e.touches);if(v&&E.current.contains(e.target)&&null==nodeThatClaimedTheSwipe){var a=findNativeHandler({domTreeShapes:getDomTreeShapes(e.target,E.current),start:r?R.current.startX:R.current.startY,current:r?n:t,anchor:l});if(a)return void(nodeThatClaimedTheSwipe=a);nodeThatClaimedTheSwipe=R.current}if(null==R.current.isSwiping){var i=Math.abs(n-R.current.startX),a=Math.abs(t-R.current.startY);a<i&&e.cancelable&&e.preventDefault();var o=r?a<i&&UNCERTAINTY_THRESHOLD<i:i<a&&UNCERTAINTY_THRESHOLD<a;if(!0==o||(r?UNCERTAINTY_THRESHOLD<a:UNCERTAINTY_THRESHOLD<i)){if(!(R.current.isSwiping=o))return void x(e);R.current.startX=n,R.current.startY=t,s||v||(r?R.current.startX-=y:R.current.startY-=y)}}if(R.current.isSwiping){i=getMaxTranslate(r,E.current),o=r?R.current.startX:R.current.startY,o=getTranslate(r?n:t,o=v&&!R.current.paperHit?Math.min(o,i):o,v,i);if(v)if(R.current.paperHit)0===o&&(R.current.startX=n,R.current.startY=t);else{if(!(r?n<i:t<i))return;R.current.paperHit=!0,R.current.startX=n,R.current.startY=t}null===R.current.lastTranslate&&(R.current.lastTranslate=o,R.current.lastTime=performance.now()+1);t=(o-R.current.lastTranslate)/(performance.now()-R.current.lastTime)*1e3;R.current.velocity=.4*R.current.velocity+.6*t,R.current.lastTranslate=o,R.current.lastTime=performance.now(),e.cancelable&&e.preventDefault(),P(o)}}}),M=(0,_useEventCallback.default)(function(e){if(!e.defaultPrevented&&!e.muiHandled&&(!v||S.current.contains(e.target)||E.current.contains(e.target))){var t=(0,_Drawer.getAnchor)(u,l),r=(0,_Drawer.isHorizontal)(l),n=calculateCurrentX(t,e.touches),t=calculateCurrentY(t,e.touches);if(!v){if(p||e.target!==D.current)return;if(r){if(y<n)return}else if(y<t)return}e.muiHandled=!0,nodeThatClaimedTheSwipe=null,R.current.startX=n,R.current.startY=t,g(!0),!v&&E.current&&P(getMaxTranslate(r,E.current)+(s?20:-y),{changeTransition:!1}),R.current.velocity=0,R.current.lastTime=null,R.current.lastTranslate=null,R.current.paperHit=!1,C.current=!0}});React.useEffect(function(){if("temporary"===b){var e=(0,_ownerDocument.default)(E.current);return e.addEventListener("touchstart",M),e.addEventListener("touchmove",H,{passive:!1}),e.addEventListener("touchend",x),function(){e.removeEventListener("touchstart",M),e.removeEventListener("touchmove",H,{passive:!1}),e.removeEventListener("touchend",x)}}},[b,M,H,x]),React.useEffect(function(){return function(){nodeThatClaimedTheSwipe===R.current&&(nodeThatClaimedTheSwipe=null)}},[]),React.useEffect(function(){v||g(!1)},[v]);n=React.useCallback(function(e){S.current=ReactDOM.findDOMNode(e)},[]);return React.createElement(React.Fragment,null,React.createElement(_Drawer.default,(0,_extends2.default)({open:!("temporary"!==b||!r)||v,variant:b,ModalProps:(0,_extends2.default)({BackdropProps:(0,_extends2.default)({},a,{ref:n})},i),PaperProps:(0,_extends2.default)({},f,{style:(0,_extends2.default)({pointerEvents:"temporary"!==b||v?"":"none"},f.style),ref:E}),anchor:l,transitionDuration:q.current||w,onClose:_,ref:t},c)),!p&&"temporary"===b&&React.createElement(_NoSsr.default,null,React.createElement(_SwipeArea.default,(0,_extends2.default)({anchor:l,ref:D,width:y},e))))});"production"!==process.env.NODE_ENV&&(SwipeableDrawer.propTypes={anchor:_propTypes.default.oneOf(["left","top","right","bottom"]),children:_propTypes.default.node,disableBackdropTransition:_propTypes.default.bool,disableDiscovery:_propTypes.default.bool,disableSwipeToOpen:_propTypes.default.bool,hideBackdrop:_propTypes.default.bool,hysteresis:_propTypes.default.number,minFlingVelocity:_propTypes.default.number,ModalProps:_propTypes.default.shape({BackdropProps:_propTypes.default.shape({component:_utils.elementTypeAcceptingRef})}),onClose:_propTypes.default.func.isRequired,onOpen:_propTypes.default.func.isRequired,open:_propTypes.default.bool.isRequired,PaperProps:_propTypes.default.shape({component:_utils.elementTypeAcceptingRef,style:_propTypes.default.object}),SwipeAreaProps:_propTypes.default.object,swipeAreaWidth:_propTypes.default.number,transitionDuration:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.shape({enter:_propTypes.default.number,exit:_propTypes.default.number})]),variant:_propTypes.default.oneOf(["permanent","persistent","temporary"])});var _default=SwipeableDrawer;exports.default=_default;